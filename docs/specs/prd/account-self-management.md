# PRD: 계정 자기 관리

> SDD 작성자가 작성하는 제품 요구사항 문서입니다.
> 사업 에이전트의 `docs/business/` 문서를 기반으로 작성합니다.

## 배경/문제 요약

- **참고**: `docs/business/6_roadmap/roadmap.md` (2단계), `docs/business/STATUS.md`
- **문제**:
  - 현재 사용자가 비밀번호를 잊으면 스스로 복구할 수 없음 (운영자에게 연락해야 함)
  - 계정 이름(displayName) 변경 기능 없음
  - 계정 탈퇴 기능 없음 → 개인정보 처리방침에 명시된 "동의 철회, 삭제 요청 가능" 이행 불가
  - 사용자 자립 기능 부재로 CS 부담 증가, 운영 확장 시 병목
- **현재 상태**: 계정 정보 조회(`account.get`)와 개인정보 동의(`account.agreePrivacy`)만 존재
- **목표 상태**: 사용자가 직접 비밀번호 재설정/변경, 이름 변경, 계정 탈퇴를 수행할 수 있는 자기 관리 기능

## 목표/성공 기준

- **목표**:
  - 사용자가 운영자 도움 없이 계정 정보를 직접 관리할 수 있게 함
  - 개인정보보호법 준수: 사용자 요청에 의한 데이터 삭제(탈퇴) 지원
- **성공 지표**:
  - 계정 관련 CS 문의 0건 (운영자 개입 불필요)
  - 탈퇴 프로세스 완료 시 관련 데이터 완전 삭제 확인
- **측정 기간**: 배포 후 4주

## 사용자/대상

- **주요 사용자**: 서비스에 가입한 모임 운영자 (교리교사)
- **사용 맥락**:
  - 비밀번호를 잊어서 로그인할 수 없을 때 (비밀번호 재설정)
  - 보안상 비밀번호를 바꾸고 싶을 때 (비밀번호 변경)
  - 모임명이 바뀌었을 때 (이름 변경)
  - 서비스를 더 이상 사용하지 않을 때 (계정 탈퇴)

## 범위

### 포함

- 비밀번호 재설정 (아이디 + 이메일 입력 → 임시 비밀번호 발송)
- 비밀번호 변경 (현재 비밀번호 확인 → 새 비밀번호 설정)
- 이름(displayName) 변경
- 계정 탈퇴 (관련 데이터 소프트 삭제)
- 계정 복구 (탈퇴 후 2년 이내 동일 아이디+비밀번호로 복원)
- 계정 설정 페이지 (`/settings`)

### 제외

- 아이디(name) 변경 — 로그인 ID는 불변
- 이메일 인증, 2단계 인증(2FA)

## 사용자 시나리오

1. **비밀번호 재설정**: 사용자가 로그인 페이지에서 "비밀번호 찾기"를 클릭 → 아이디와 이메일을 입력 → 임시 비밀번호가 이메일로 발송됨 → 임시 비밀번호로 로그인.
2. **비밀번호 변경**: 사용자가 설정 페이지에서 현재 비밀번호와 새 비밀번호를 입력하여 비밀번호를 변경한다.
3. **이름 변경**: 사용자가 설정 페이지에서 표시 이름을 수정하고 저장한다.
4. **계정 탈퇴**: 사용자가 설정 페이지에서 "계정 삭제"를 클릭하면, 경고와 함께 비밀번호 확인 후 계정과 모든 관련 데이터가 삭제된다.

## 요구사항

### 필수 (Must)

- [ ] 비밀번호 재설정: 아이디 + 이메일 입력 → 임시 비밀번호 생성 → 이메일 발송 → 기존 비밀번호를 임시 비밀번호로 교체
- [ ] 비밀번호 변경: 현재 비밀번호 검증 → 새 비밀번호 설정 (8자 이상)
- [ ] 이름 변경: displayName 수정 (2~20자)
- [ ] 계정 탈퇴: 비밀번호 확인 후 계정 + 그룹 + 학생 + 출석 데이터 소프트 삭제
- [ ] 탈퇴 시 확인 다이얼로그: 삭제 경고 + 2년 이내 복원 가능 안내
- [ ] 탈퇴 완료 후 세션 클리어 → 로그인 페이지 이동
- [ ] 계정 설정 페이지 (`/settings`) 신규
- [ ] 비밀번호 찾기 페이지 (`/reset-password`) 신규

### 선택 (Should)

- [ ] 탈퇴 전 데이터 내보내기 (Export) 안내
- [ ] GA4 이벤트 추적 (비밀번호 변경/재설정, 이름 변경, 탈퇴)

### 제외 (Out)

- 아이디(name) 변경
- 이메일 인증, 2FA
- Account에 email 필드 저장 (재설정 시 입력받기만 함)

## 제약/가정/리스크

- **제약**:
  - Account 모델에 email 필드 없음 → 재설정 시 이메일 소유권 검증 불가
  - SMTP 인프라 기존 구축 완료 (회원가입 알림에 사용 중)
  - 공유 계정 특성상 탈퇴 시 모든 데이터 삭제는 해당 모임 전체에 영향
- **가정**:
  - 비밀번호 재설정: 아이디를 아는 사람이 이메일 주소를 입력하면 해당 이메일로 임시 비밀번호 발송 (이메일 소유권 미검증, 소규모 서비스 리스크 수용)
  - 계정 탈퇴는 소프트 삭제 (2년 보관 후 파기). 개인정보 처리방침 "비활성화 후 2년 이내 파기" 준수. 2년 이내 계정 복원 가능.
- **리스크**:
  - 아이디만 알면 누구나 비밀번호 재설정 가능 → 아이디 자체가 비공개이므로 리스크 낮음
  - 탈퇴 시 실수로 데이터 삭제 → 비밀번호 확인 + 경고 다이얼로그로 방어 + 2년 이내 복원 가능
  - 공유 계정에서 한 사용자가 임의로 탈퇴 → 현재 구조상 방지 불가 (계정 소유자 책임)

## 의존성

- **내부**:
  - 기존 인증 플로우 (auth.login, account.get)
  - 기존 SMTP 인프라 (`apps/api/src/infrastructure/mail/`)
  - 개인정보 동의 완료 상태에서만 설정 접근 가능 (consentedProcedure)
- **외부**:
  - 없음

## 롤아웃/검증

- **출시 단계**: 단일 배포
- **이벤트/로그**:
  - `password_reset_requested`: 비밀번호 재설정 요청
  - `password_reset_completed`: 임시 비밀번호 발송 완료
  - `password_changed`: 비밀번호 변경 완료
  - `display_name_changed`: 이름 변경 완료
  - `account_deleted`: 계정 탈퇴 완료
- **검증 방법**: 배포 후 설정 페이지 접근률, 각 기능 사용률 모니터링

## 오픈 이슈

- [x] 탈퇴 시 물리적 삭제 vs 소프트 삭제 → 소프트 삭제 (2년 보관 후 파기, 복원 기능 포함)
- [x] 비밀번호 재설정 방식 → 이메일 소유권 미검증, 입력받은 이메일로 임시 비밀번호 발송

## 연결 문서

- 사업 문서: `docs/business/6_roadmap/roadmap.md` (2단계)
- 기능 설계: `docs/specs/functional-design/auth-account.md`
- PRD: `docs/specs/prd/privacy-consent.md` (개인정보 삭제 → 탈퇴 연계)

---

**작성일**: 2026-02-15
**작성자**: SDD 작성자
**상태**: Approved (구현 완료)

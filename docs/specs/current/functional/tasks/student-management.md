# Task: 학생 관리

> 업무 단위 설계 문서입니다.
> Feature 문서를 기반으로 **유스케이스와 엣지 케이스**를 정리합니다.

## 상위 문서

- PRD: `docs/specs/prd/school-attendance.md`
- 기능 설계: `docs/specs/functional-design/student-management.md` (기본 + 일괄 삭제/복구 + 졸업 처리 + 엑셀 Import 포함)
- Feature: `docs/specs/current/functional/features/student-management.md`

## 목표

학생 목록 조회/검색, 학생 CRUD, 졸업(진급) 처리를 제공한다.

## 범위

### 포함
- [x] 학생 목록 조회(페이지네이션)
- [x] 검색 옵션 적용
- [x] 학생 상세 조회
- [x] 학생 추가/수정/삭제
- [x] 졸업/진급 처리
- [x] 연례 나이 증가 스케줄

### 포함 - 로드맵 1단계 (삭제/복구)
- [ ] 학생 상세 페이지 (행 클릭 시 이동)
- [ ] 인라인 수정 (포커스 아웃 시 자동 저장)
- [ ] 삭제 필터 (재학생/삭제된 학생)
- [ ] 학생 다중 선택 UI
- [ ] 학생 일괄 삭제 (bulkDelete API)
- [ ] 삭제된 학생 복구 (restore API)
- [ ] 테이블 UI 개선 (호버, 하이라이트, 토스트)
- [ ] 삭제 확인 다이얼로그

### 포함 - 로드맵 1단계 (졸업 처리)
- [ ] DB 스키마 변경 (`graduated_at` 필드 추가)
- [ ] 기존 API 이름 변경 (`student.graduate` → `student.promote`)
- [ ] 일괄 졸업 처리 API (`student.graduate`)
- [ ] 졸업 취소 API (`student.cancelGraduation`)
- [ ] 학생 목록 API 졸업 필터 추가
- [ ] 프론트엔드 졸업 처리 UI
- [ ] 프론트엔드 졸업 필터 UI
- [ ] 통합 테스트

### 제외
- [ ] 학생 사진/첨부파일
- [ ] 다중 계정 간 학생 공유
- [ ] 졸업생 데이터 이관 (다른 계정으로 전달) - 로드맵 3단계

## 유스케이스

### UC-1: 학생 목록 조회

**전제 조건**: 유효한 Access Token이 있다.

**주요 흐름**:
1. `/api/student`에 페이지/검색 파라미터를 포함해 요청한다.
2. 서버가 계정이 관리하는 학생 목록을 반환한다.

**결과**: `page`, `size`, `totalPage`, `students`가 포함된 응답을 받는다.

### UC-2: 학생 추가

**전제 조건**: 유효한 Access Token이 있다.

**주요 흐름**:
1. 학생 정보를 포함해 `/api/student`에 POST 요청한다.
2. 서버가 학생을 생성한다.

**결과**: 생성된 학생 정보가 반환된다.

### UC-3: 학생 조회/수정/삭제

**전제 조건**: 유효한 Access Token이 있고 studentId가 숫자이다.

**주요 흐름**:
1. `/api/student/:studentId`에 GET/PUT/DELETE 요청을 보낸다.
2. 서버가 학생 정보를 반환/수정/소프트 삭제한다.

**결과**: 각 작업의 결과가 응답으로 반환된다.

### UC-4: 졸업/진급 처리

**전제 조건**: 특정 계정(초등부/중고등부)으로 로그인되어 있다.

**주요 흐름**:
1. `/api/student/graduation`에 요청한다.
2. 서버가 졸업/진급 규칙을 적용한다.

**결과**: 이동된 학생 수가 반환된다.

### UC-5: 학생 상세 페이지 조회 (로드맵 1단계)

**전제 조건**: 유효한 Access Token이 있고, 학생 목록 페이지에 있다.

**주요 흐름**:
1. 학생 목록에서 특정 학생 행을 클릭한다.
2. `/students/:studentId` 상세 페이지로 이동한다.
3. 학생 정보(이름, 세례명, 나이, 연락처, 축일, 메모, 그룹)가 표시된다.

**결과**: 학생 상세 정보가 인라인 편집 가능한 형태로 표시된다.

**관련 업무**: #7, #8

### UC-6: 인라인 수정 (로드맵 1단계)

**전제 조건**: 학생 상세 페이지에 있다.

**주요 흐름**:
1. 필드(이름, 세례명 등)를 클릭한다.
2. 인라인 편집 모드로 전환된다.
3. 값을 수정하고 포커스를 이동한다 (Tab, 클릭 등).
4. 포커스 아웃 시 API가 자동 호출되어 저장된다.

**결과**: 변경된 값이 저장되고 토스트 메시지로 성공 알림이 표시된다.

**관련 업무**: #9

### UC-7: 학생 일괄 삭제 (로드맵 1단계)

**전제 조건**: 학생 목록 페이지에 재학생 필터가 적용되어 있다.

**주요 흐름**:
1. 학생 목록에서 삭제할 학생의 체크박스를 선택한다.
2. 삭제 버튼을 클릭한다.
3. 확인 다이얼로그가 표시된다 (선택된 학생 목록 포함).
4. 확인을 클릭하면 선택된 학생이 일괄 삭제된다.
5. 목록이 갱신되고 deletedCount가 토스트로 표시된다.

**결과**: 선택된 학생이 모두 소프트 삭제되고 목록에서 제거된다.

**관련 업무**: #10, #11, #14

### UC-8: 삭제된 학생 복구 (로드맵 1단계)

**전제 조건**: 학생 목록 페이지에 "삭제된 학생" 필터가 적용되어 있다.

**주요 흐름**:
1. 삭제된 학생 필터를 선택한다.
2. 삭제된 학생 목록이 표시된다.
3. 복구할 학생의 체크박스를 선택한다.
4. 복구 버튼을 클릭한다.
5. 선택된 학생이 복구되고 재학생 목록으로 돌아간다.

**결과**: 선택된 학생이 복구되어 재학생 필터에서 다시 보인다.

**관련 업무**: #10, #12

### UC-9: 일괄 졸업 처리 (로드맵 1단계)

**전제 조건**: 로그인 상태, 본인 계정의 재학생이 존재

**주요 흐름**:
1. 학생 목록 화면에서 재학생 필터 상태 확인
2. 졸업 대상 학생 체크박스 선택 (1~100명)
3. "N명 졸업 처리" 버튼 클릭
4. 확인 모달에서 선택된 학생 목록 확인
5. "졸업 처리" 버튼 클릭
6. API 호출 (`student.graduate`)
7. 성공 시 토스트 메시지 표시
8. 학생 목록 갱신 (졸업생 숨김)

**결과**: 선택된 학생의 `graduatedAt` 필드에 현재 시간 설정

**관련 업무**: #20, #23, #25

### UC-10: 졸업생 조회 (로드맵 1단계)

**전제 조건**: 로그인 상태, 졸업생이 존재

**주요 흐름**:
1. 학생 목록 화면에서 졸업 필터 클릭
2. "졸업생" 옵션 선택
3. API 호출 (`student.list` with `graduated: true`)
4. 졸업생 목록 표시 (졸업 배지 포함)

**결과**: `graduatedAt != null`인 학생 목록 반환

**관련 업무**: #22, #23, #24

### UC-11: 졸업 취소 (로드맵 1단계)

**전제 조건**: 로그인 상태, 졸업생이 존재

**주요 흐름**:
1. 학생 목록에서 "졸업생" 필터 선택
2. 졸업 취소할 학생 체크박스 선택
3. "졸업 취소" 버튼 클릭
4. 확인 모달에서 확인
5. API 호출 (`student.cancelGraduation`)
6. 성공 시 토스트 메시지 표시
7. 학생 목록 갱신 (재학생으로 복귀)

**결과**: 선택된 학생의 `graduatedAt` 필드가 null로 설정

**관련 업무**: #21, #23, #26

## 업무 분할 (로드맵 1단계)

| # | 업무 | 설명 | 의존성 | 예상 규모 |
|---|------|------|--------|----------|
| 7 | 학생 상세 페이지 라우트 | `/students/:id` 라우트 및 StudentDetailPage 생성 | 없음 | S |
| 8 | 학생 상세 조회 API 연동 | student.get tRPC 프로시저 활용 | #7 | S |
| 9 | 인라인 수정 컴포넌트 | 필드별 인라인 편집 UI, 포커스 아웃 시 자동 저장 | #7 | M |
| 10 | 다중 선택 UI | 체크박스, 전체 선택, 선택 상태 관리 | 없음 | M |
| 11 | 일괄 삭제 기능 | bulkDelete API 구현 및 UI 연동 | #10 | M |
| 12 | 삭제 복구 기능 | restore API 구현 및 UI 연동 | #10, #13 | M |
| 13 | 삭제 필터 | 재학생/삭제된 학생 필터 UI (includeDeleted, onlyDeleted) | 없음 | S |
| 14 | 삭제 확인 다이얼로그 | shadcn/ui AlertDialog, 선택된 학생 목록 표시 | #11 | S |
| 15 | 테이블 UI 개선 | 호버 효과, 선택 하이라이트, 행 클릭 영역 | 없음 | S |
| 16 | 토스트 피드백 | shadcn/ui toast, 성공/실패 메시지 | 없음 | S |

### 졸업 처리 (로드맵 1단계)

| # | 업무 | 설명 | 의존성 | 예상 규모 |
|---|------|------|--------|----------|
| 17 | DB 스키마 변경 | Student 테이블에 `graduated_at` 필드 추가 | 없음 | S |
| 18 | 기존 API 이름 변경 | `student.graduate` → `student.promote` | 없음 | S |
| 19 | tRPC 스키마 정의 | 졸업/취소 Input/Output 스키마, 목록 필터 스키마 추가 | 없음 | S |
| 20 | 졸업 처리 UseCase | `GraduateStudentsUseCase` 구현 | #17, #19 | M |
| 21 | 졸업 취소 UseCase | `CancelGraduationUseCase` 구현 | #17, #19 | M |
| 22 | 목록 조회 UseCase 수정 | `ListStudentsUseCase`에 graduated 필터 추가 | #17, #19 | S |
| 23 | Router 연결 | tRPC Router에 프로시저 등록 | #18, #20, #21, #22 | S |
| 24 | 프론트엔드 - 졸업 필터 UI | Select 컴포넌트로 필터 구현 | #23 | S |
| 25 | 프론트엔드 - 졸업 처리 UI | 체크박스 선택 + 졸업 처리 버튼 + 확인 모달 | #23, #24 | M |
| 26 | 프론트엔드 - 졸업 취소 UI | 졸업생 필터에서 졸업 취소 버튼 | #23, #24 | S |
| 27 | 통합 테스트 | 졸업/취소/필터 API 테스트 | #23 | M |

### 업무 순서 다이어그램

```
[#7 상세 페이지] ──▶ [#8 API 연동] ──▶ [#9 인라인 수정]
                                            │
[#10 다중 선택] ──┬──▶ [#11 일괄 삭제] ──▶ [#14 확인 다이얼로그]
                 │
                 └──▶ [#13 상태 필터] ──▶ [#12 복구 기능]
                                            │
[#15 테이블 UI] ──────────────────────────────┤
                                            │
[#16 토스트] ◀──────────────────────────────┘
```

## 엣지 케이스 & 예외 처리

| 상황 | 처리 방법 | 관련 업무 | 우선순위 |
|------|----------|----------|---------|
| studentId가 숫자가 아님 | BAD_REQUEST 응답 | 기본 | High |
| 토큰 누락 | 인증 실패 응답 | 기본 | High |
| 검색 옵션이 없음/알 수 없음 | 전체 목록 반환 | 기본 | Medium |
| 검색어가 비어 있음 | 해당 필터 무시 | 기본 | Medium |
| 필수 필드 누락 | 실패 응답 | 기본 | Medium |
| 졸업 대상 없음 | row=0 반환 | 기본 | Low |
| 일괄 삭제 빈 배열 (로드맵 1단계) | BAD_REQUEST 응답, UI에서 버튼 비활성화 | #11 | High |
| 일괄 삭제 일부 학생 없음 (로드맵 1단계) | 존재하는 학생만 삭제, deletedCount 반환 | #11 | Medium |
| 복구 빈 배열 (로드맵 1단계) | BAD_REQUEST 응답, UI에서 버튼 비활성화 | #12 | High |
| 인라인 수정 필수 필드 누락 (로드맵 1단계) | BAD_REQUEST 응답, 원래 값 복원 | #9 | High |
| 인라인 수정 중 ESC 키 (로드맵 1단계) | 수정 취소, 원래 값 복원 | #9 | Medium |
| 삭제 확인 취소 (로드맵 1단계) | 삭제 중단, 선택 상태 유지 | #14 | Low |
| 재학생 목록에서 복구 버튼 (로드맵 1단계) | 복구 버튼 숨김 (삭제 버튼만 표시) | #13 | Low |
| 삭제된 학생 목록에서 삭제 버튼 (로드맵 1단계) | 삭제 버튼 숨김 (복구 버튼만 표시) | #13 | Low |
| 졸업 처리 빈 studentIds 배열 (로드맵 1단계) | 400 BAD_REQUEST 반환 | #20, #21 | High |
| 졸업 처리 100명 초과 요청 (로드맵 1단계) | 400 BAD_REQUEST 반환 ("최대 100명까지 처리 가능합니다") | #20, #21 | High |
| 존재하지 않는 학생 ID 졸업 요청 (로드맵 1단계) | 존재하는 학생만 처리, 처리된 수 반환 | #20, #21 | Medium |
| 다른 계정의 학생 ID 졸업 요청 (로드맵 1단계) | 본인 계정 학생만 처리, 타 계정 무시 | #20, #21 | High |
| 이미 졸업한 학생 재졸업 (로드맵 1단계) | 무시 (처리 수에서 제외) | #20 | Medium |
| 재학생 졸업 취소 요청 (로드맵 1단계) | 무시 (처리 수에서 제외) | #21 | Medium |
| 졸업 트랜잭션 실패 (로드맵 1단계) | 전체 롤백, 에러 메시지 반환 | #20, #21 | High |

## 검증 체크리스트

### 기본 기능 검증
- [x] 목록 응답에 페이지 정보가 포함되는가?
- [x] 검색 옵션별 필터링이 동작하는가?
- [x] 학생 CRUD가 정상 동작하는가?
- [x] 잘못된 studentId가 BAD_REQUEST로 처리되는가?
- [x] 졸업/진급 처리 결과가 반환되는가?

### 로드맵 1단계 검증
- [ ] 학생 행 클릭 시 상세 페이지로 이동하는가?
- [ ] 상세 페이지에서 학생 정보가 표시되는가?
- [ ] 필드 클릭 시 인라인 편집 모드로 전환되는가?
- [ ] 포커스 아웃 시 자동 저장되는가?
- [ ] 삭제 필터(재학생/삭제된 학생)가 동작하는가?
- [ ] 다중 선택 체크박스가 정상 동작하는가?
- [ ] 전체 선택/해제가 정상 동작하는가?
- [ ] 선택된 학생이 없을 때 삭제/복구 버튼이 비활성화되는가?
- [ ] 재학생 목록에서는 삭제 버튼만, 삭제된 학생 목록에서는 복구 버튼만 표시되는가?
- [ ] 일괄 삭제 시 확인 다이얼로그가 표시되는가?
- [ ] 일괄 삭제 후 목록이 갱신되는가?
- [ ] 복구 후 목록이 갱신되는가?
- [ ] 테이블 호버/선택 효과가 적용되는가?
- [ ] 토스트 메시지가 적절히 표시되는가?

### 졸업 처리 검증 (로드맵 1단계)
- [ ] UC-9: 일괄 졸업 처리가 정상 동작하는가?
- [ ] UC-10: 졸업생 필터로 졸업생만 조회되는가?
- [ ] UC-11: 졸업 취소가 정상 동작하는가?
- [ ] 전체 필터로 재학생+졸업생이 조회되는가?
- [ ] 졸업 관련 엣지 케이스가 적절히 처리되는가?
- [ ] 기존 기능(진급)이 `student.promote`에서 동일하게 동작하는가?
- [ ] 졸업 처리 시 데이터(출석 기록)가 보존되는가?
- [ ] 졸업 취소 시 `graduatedAt`이 null로 복원되는가?

## 다음 단계

- [x] Development 문서 작성: `docs/specs/current/functional/development/student-management.md`

---

**작성일**: 2026-01-05
**최종 수정**: 2026-01-22
**담당자**: Codex
**상태**: Approved (기본 + 로드맵 1단계)
**예상 작업량**: L (기본) + L (로드맵 1단계)

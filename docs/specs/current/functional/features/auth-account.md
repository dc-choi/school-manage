# Feature: 인증 및 계정 확인

> 이 문서는 기능의 **단일 정보원(Single Source of Truth)** 입니다.
> 기술적 구현 방법이 아닌 **"무엇을"** 만들지에 집중합니다.

## 개요

계정은 ID/비밀번호로 로그인하여 Access Token을 발급받고, 토큰으로 본인 계정을 확인한다.

## 배경

- 계정별로 그룹/학생 데이터를 분리해 관리해야 한다.
- 보호된 API 접근을 위해 인증 수단이 필요하다.

## 사용자 스토리

### US-1: 로그인하여 관리 기능을 사용한다
- **사용자**: 교사/관리자
- **원하는 것**: ID/비밀번호로 로그인하고 Access Token을 받기
- **이유**: 그룹/학생 관리 기능에 접근하기 위해

### US-2: 토큰으로 현재 계정을 확인한다
- **사용자**: 로그인한 사용자
- **원하는 것**: 토큰으로 현재 계정 이름을 확인하기
- **이유**: 현재 세션이 유효한지 검증하기 위해

## 기능 요구사항

### 필수 (Must Have)
- [x] ID/비밀번호로 로그인할 수 있어야 한다.
- [x] 로그인 성공 시 Access Token과 계정 이름을 반환해야 한다.
- [x] Access Token으로 보호된 API에 접근할 수 있어야 한다.
- [x] `/api/account`에서 토큰 기반으로 계정 이름을 확인할 수 있어야 한다.
- [x] 토큰 만료/유효성 오류는 명확한 에러 코드로 응답해야 한다.

### 선택 (Nice to Have)
- [x] 없음 (현재 스코프)

## 엣지 케이스

| 케이스                 | 예상 동작                  |
|---------------------|------------------------|
| 존재하지 않는 ID로 로그인     | NOT_FOUND 코드로 실패 응답    |
| 잘못된 비밀번호            | UNAUTHORIZED 코드로 실패 응답 |
| Authorization 헤더 누락 | 인증 실패 응답               |
| 서명/형식이 잘못된 토큰       | UNAUTHORIZED 코드로 실패 응답 |
| 만료된 토큰              | UNAUTHORIZED 코드로 실패 응답 |

## 인수 조건 (Acceptance Criteria)

- [x] 로그인 성공 시 `name`, `accessToken`을 포함한 결과를 반환한다.
- [x] ID가 없으면 NOT_FOUND 코드로 실패한다.
- [x] 비밀번호가 틀리면 UNAUTHORIZED 코드로 실패한다.
- [x] 토큰이 없으면 인증 실패로 처리된다.
- [x] 만료된 토큰은 UNAUTHORIZED 코드로 실패한다.
- [x] `/api/account`는 유효한 토큰에서 계정 이름을 반환한다.

## 관련 문서

- PRD: `docs/specs/prd/school-attendance.md` (회원가입 포함)
- 기능 설계: `docs/specs/functional-design/auth-account.md`
- Task: `docs/specs/current/functional/tasks/auth-account.md`
- Development: `docs/specs/current/functional/development/auth-account.md`

---

## 회원가입 (로드맵 1단계)

> PRD: `docs/specs/prd/school-attendance.md` (로드맵 1단계 섹션)
> 기능 설계: `docs/specs/functional-design/auth-account.md`

### 배경

- 현재 계정은 DB에 직접 생성해야만 사용 가능
- 신규 사용자가 스스로 가입할 수 있는 경로 필요
- 마케팅(인스타그램 등) → 가입 → 사용의 전환 경로 확보

### 사용자 스토리

#### US-3: 신규 사용자로 회원가입한다
- **사용자**: 신규 사용자 (교리교사, 주일학교 운영자)
- **원하는 것**: ID/이름/비밀번호를 입력하여 계정을 생성하고 서비스를 이용하기
- **이유**: 서비스에 가입하여 그룹/학생 관리 기능을 사용하기 위해

#### US-4: ID 중복 여부를 확인한다
- **사용자**: 회원가입 중인 사용자
- **원하는 것**: 입력한 ID가 사용 가능한지 미리 확인하기
- **이유**: 가입 시도 전에 중복 여부를 알기 위해

### 기능 요구사항

#### 필수 (Must Have)
- [x] 회원가입 화면이 있어야 한다
- [x] ID (4~20자, 영문 소문자/숫자)를 입력받아야 한다
- [x] ID 입력 시 대문자는 소문자로 자동 변환되어야 한다
- [x] ID 중복 확인이 가능해야 한다
- [x] 이름 (2~20자)을 입력받아야 한다
- [x] 비밀번호 (8자 이상)를 입력받아야 한다
- [x] 비밀번호 확인을 입력받아야 한다
- [x] 비밀번호와 비밀번호 확인이 일치해야 가입 가능하다
- [x] 가입 성공 시 자동 로그인되어야 한다
- [x] 가입 성공 시 대시보드로 이동해야 한다
- [x] 로그인 화면에서 회원가입 링크가 있어야 한다

#### 선택 (Nice to Have)
- [x] 입력 필드별 실시간 유효성 검증
- [ ] 비밀번호 강도 표시
- [ ] 비밀번호 보기/숨기기 토글

### 엣지 케이스

| 케이스 | 예상 동작 |
|--------|----------|
| ID 형식 오류 (특수문자, 대문자) | 대문자는 소문자로 자동 변환, 특수문자는 BAD_REQUEST |
| ID 길이 오류 (4~20자 벗어남) | BAD_REQUEST 코드로 실패 응답 |
| ID 중복 | CONFLICT 코드로 실패 응답 |
| 이름 길이 오류 (2~20자 벗어남) | BAD_REQUEST 코드로 실패 응답 |
| 비밀번호 길이 오류 (8자 미만) | BAD_REQUEST 코드로 실패 응답 |
| 비밀번호 확인 불일치 | 클라이언트에서 가입 버튼 비활성화 |
| 필수 필드 누락 | BAD_REQUEST 코드로 실패 응답 |

### 인수 조건 (Acceptance Criteria)

- [x] 회원가입 화면에서 ID, 이름, 비밀번호, 비밀번호 확인을 입력할 수 있다
- [x] ID 중복 확인 시 사용 가능 여부를 알 수 있다
- [x] ID 대문자 입력 시 소문자로 변환되어 저장된다
- [x] 가입 성공 시 `name`, `displayName`, `accessToken`을 반환한다
- [x] 가입 성공 후 자동으로 대시보드로 이동한다
- [x] ID 중복 시 CONFLICT 코드로 실패한다
- [x] 유효성 검증 실패 시 BAD_REQUEST 코드로 실패한다
- [x] 로그인 화면에서 회원가입 링크를 클릭하면 회원가입 화면으로 이동한다

---

**작성일**: 2026-01-05
**최종 수정**: 2026-01-25
**상태**: Approved (기본 인증 + 회원가입 구현 완료)

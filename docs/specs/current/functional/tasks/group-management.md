# Task: 그룹 관리

> 업무 단위 설계 문서입니다.
> Feature 문서를 기반으로 **유스케이스와 엣지 케이스**를 정리합니다.

## 상위 문서

- PRD: `docs/specs/prd/school-attendance.md`
- 기능 설계: `docs/specs/functional-design/group-management.md`
- Feature: `docs/specs/current/functional/features/group-management.md`

## 목표

계정이 관리하는 그룹을 CRUD하고, 그룹 출석 현황을 조회할 수 있도록 한다.

## 범위

### 포함
- [x] 그룹 목록 조회
- [x] 그룹 생성
- [x] 그룹 상세 조회
- [x] 그룹 수정
- [x] 그룹 삭제(소프트 삭제)
- [x] 그룹 출석 현황 조회

### 포함 - 로드맵 1단계
- [ ] 그룹 상세 페이지 (학생 목록 포함)
- [ ] 그룹명 인라인 수정
- [ ] 그룹 다중 선택 UI
- [ ] 그룹 일괄 삭제 (bulkDelete API)
- [ ] 테이블 UI 개선 (호버, 하이라이트, 토스트)
- [ ] 삭제 확인 다이얼로그

### 제외
- [ ] 그룹 권한/공유 기능
- [ ] 복구 기능

## 유스케이스

### UC-1: 그룹 목록 조회

**전제 조건**: 유효한 Access Token이 있다.

**주요 흐름**:
1. `/api/group` 요청을 보낸다.
2. 서버가 계정에 속한 그룹을 반환한다.

**결과**: 그룹 배열과 계정 이름이 포함된 응답을 받는다.

### UC-2: 그룹 생성

**전제 조건**: 유효한 Access Token이 있다.

**주요 흐름**:
1. 그룹명과 함께 `/api/group`에 POST 요청을 보낸다.
2. 서버가 그룹을 생성한다.

**결과**: 생성된 그룹 정보가 반환된다.

### UC-3: 그룹 상세 조회/수정/삭제

**전제 조건**: 유효한 Access Token이 있고, groupId가 숫자이다.

**주요 흐름**:
1. `/api/group/:groupId`에 GET/PUT/DELETE 요청을 보낸다.
2. 서버가 그룹 정보를 반환/수정/소프트 삭제한다.

**결과**: 각 작업의 결과가 응답으로 반환된다.

### UC-4: 그룹 출석 현황 조회

**전제 조건**: 유효한 Access Token이 있고, groupId가 숫자이다.

**주요 흐름**:
1. `/api/group/:groupId/attendance`에 요청을 보낸다.
2. 서버가 연도별 요일 정보와 출석 데이터를 반환한다.

**결과**: 연도, 요일 배열, 학생 목록, 출석 데이터가 포함된 응답을 받는다.

### UC-5: 그룹 상세 페이지 조회 (로드맵 1단계)

**전제 조건**: 유효한 Access Token이 있고, 그룹 목록 페이지에 있다.

**주요 흐름**:
1. 그룹 목록에서 특정 그룹 행을 클릭한다.
2. `/groups/:groupId` 상세 페이지로 이동한다.
3. 그룹 정보와 소속 학생 목록이 표시된다.

**결과**: 그룹명, 학생 수, 학생 목록(이름, 세례명, 나이)이 표시된다.

**관련 업무**: #7, #8

### UC-6: 그룹명 인라인 수정 (로드맵 1단계)

**전제 조건**: 그룹 상세 페이지에 있다.

**주요 흐름**:
1. 그룹명 영역을 클릭하거나 편집 아이콘을 클릭한다.
2. 인라인 편집 모드로 전환된다.
3. 새 그룹명을 입력하고 Enter 또는 저장 버튼을 클릭한다.
4. API 호출 후 성공 시 그룹명이 갱신된다.

**결과**: 변경된 그룹명이 표시되고 토스트 메시지로 성공 알림이 표시된다.

**관련 업무**: #9

### UC-7: 그룹 일괄 삭제 (로드맵 1단계)

**전제 조건**: 그룹 목록 페이지에 있고, 삭제할 그룹이 존재한다.

**주요 흐름**:
1. 그룹 목록에서 삭제할 그룹의 체크박스를 선택한다.
2. 일괄 삭제 버튼을 클릭한다.
3. 확인 다이얼로그가 표시된다.
4. 확인을 클릭하면 선택된 그룹이 일괄 삭제된다.
5. 목록이 갱신되고 deletedCount가 토스트로 표시된다.

**결과**: 선택된 그룹이 모두 소프트 삭제되고 목록에서 제거된다.

**관련 업무**: #10, #11

## 업무 분할 (로드맵 1단계)

| # | 업무 | 설명 | 의존성 | 예상 규모 |
|---|------|------|--------|----------|
| 7 | 그룹 상세 페이지 라우트 | `/groups/:id` 라우트 및 GroupDetailPage 생성 | 없음 | S |
| 8 | 그룹 상세 조회 API 연동 | group.get tRPC 프로시저 활용, 학생 목록 포함 | #7 | S |
| 9 | 인라인 수정 컴포넌트 | 그룹명 인라인 편집 UI 및 API 연동 | #7 | M |
| 10 | 다중 선택 UI | 체크박스, 전체 선택, 선택 상태 관리 | 없음 | M |
| 11 | 일괄 삭제 기능 | bulkDelete API 구현 및 UI 연동 | #10 | M |
| 12 | 테이블 UI 개선 | 호버 효과, 선택 하이라이트, 행 클릭 영역 | 없음 | S |
| 13 | 토스트/다이얼로그 | shadcn/ui toast, AlertDialog 적용 | 없음 | S |

### 업무 순서 다이어그램

```
[#7 상세 페이지] ──▶ [#8 API 연동] ──▶ [#9 인라인 수정]
                                            │
[#10 다중 선택] ──▶ [#11 일괄 삭제] ◀────────┘
                                            │
[#12 테이블 UI] ──────────────────────────────┤
                                            │
[#13 토스트/다이얼로그] ◀────────────────────┘
```

## 엣지 케이스 & 예외 처리

| 상황 | 처리 방법 | 관련 업무 | 우선순위 |
|------|----------|----------|---------|
| groupId가 숫자가 아님 | BAD_REQUEST 응답 | 기본 | High |
| 토큰 누락 | 인증 실패 응답 | 기본 | High |
| 존재하지 않는 그룹 | NOT_FOUND 응답 | 기본 | Medium |
| 그룹명 누락 | 실패 응답 | 기본 | Medium |
| year 누락/비정상 | 현재 연도로 처리 | 기본 | Low |
| 일괄 삭제 빈 배열 (로드맵 1단계) | BAD_REQUEST 응답, UI에서 버튼 비활성화 | #11 | High |
| 일괄 삭제 일부 그룹 없음 (로드맵 1단계) | 존재하는 그룹만 삭제, deletedCount 반환 | #11 | Medium |
| 인라인 수정 빈 그룹명 (로드맵 1단계) | BAD_REQUEST 응답, UI에서 저장 버튼 비활성화 | #9 | High |
| 인라인 수정 중 ESC 키 (로드맵 1단계) | 수정 취소, 원래 값 복원 | #9 | Medium |
| 삭제 확인 취소 (로드맵 1단계) | 삭제 중단, 선택 상태 유지 | #11, #13 | Low |

## 검증 체크리스트

### 기본 기능 검증
- [x] 그룹 목록이 정상 반환되는가?
- [x] 그룹 생성/수정/삭제가 정상 동작하는가?
- [x] 그룹 삭제 후 조회 시 NOT_FOUND가 반환되는가?
- [x] 출석 현황 응답이 필요한 필드를 포함하는가?
- [x] 토큰 누락/잘못된 groupId가 적절히 처리되는가?

### 로드맵 1단계 검증
- [ ] 그룹 행 클릭 시 상세 페이지로 이동하는가?
- [ ] 상세 페이지에서 그룹 정보와 학생 목록이 표시되는가?
- [ ] 그룹명 인라인 수정이 정상 동작하는가?
- [ ] 인라인 수정 중 ESC로 취소할 수 있는가?
- [ ] 다중 선택 체크박스가 정상 동작하는가?
- [ ] 전체 선택/해제가 정상 동작하는가?
- [ ] 선택된 그룹이 없을 때 일괄 삭제 버튼이 비활성화되는가?
- [ ] 일괄 삭제 시 확인 다이얼로그가 표시되는가?
- [ ] 일괄 삭제 후 목록이 갱신되는가?
- [ ] 테이블 호버/선택 효과가 적용되는가?
- [ ] 토스트 메시지가 적절히 표시되는가?

## 다음 단계

- [x] Development 문서 작성: `docs/specs/current/functional/development/group-management.md`

---

**작성일**: 2026-01-05
**최종 수정**: 2026-01-22
**담당자**: Codex
**상태**: Approved (기본 + 로드맵 1단계)
**예상 작업량**: M (기본) + M (로드맵 1단계)

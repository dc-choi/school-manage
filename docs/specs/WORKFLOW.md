# SDD Workflow (Claude Code)

이 문서는 SDD 실행을 위한 **역할 분리 워크플로우**를 정의합니다.

## 3개 세션 구조

```
[사업 에이전트]          [작성자]                    [검수자]
 Claude Code      →    Claude Code         ↔     Claude Code
   (세션 1)             (세션 2)                   (세션 3)
docs/business/       PRD + 기능 설계              검수 + 승인
                     Task (역할별)
                     Development (역할별)
                     구현
```

## 역할 분담

| 세션 | 역할          | 책임                                | 산출물 위치           |
|----|-------------|-----------------------------------|------------------|
| 1  | **사업 에이전트** | 문제 정의, 가치, 우선순위, 로드맵              | `docs/business/` |
| 2  | **작성자**     | PRD, 기능 설계, Task, Development, 구현 | `docs/specs/`    |
| 3  | **검수자**     | 각 단계별 검수 + 최종 승인                  | -                |

| 역할            | 담당자                | 책임                |
|---------------|--------------------|-------------------|
| **사용자 (조율자)** | 개발자                | 에이전트 간 핸드오프 조율    |
| **사업 에이전트**   | Claude Code (세션 1) | 문제 정의 + 가치 + 우선순위 |
| **작성자**       | Claude Code (세션 2) | 문서 작성 + 구현 + 테스트  |
| **검수자**       | Claude Code (세션 3) | 각 단계별 검수 + 최종 승인  |

> **Note**: 각 에이전트는 서로 다른 세션에서 진행하여 독립성을 유지한다.

---

## 핸드오프 포인트

| 핸드오프          | 트리거        | 전달 내용                                |
|---------------|------------|--------------------------------------|
| **사업 → 작성자**  | 로드맵 등록 완료  | 문제 정의, 로드맵 (`docs/business/`)        |
| **작성자 → 검수자** | 각 문서 작성 완료 | PRD/기능 설계/Task/Development 경로, 검수 요청 |
| **검수자 → 작성자** | 수정 필요 시    | 수정 요청 사항                             |

---

## 전체 워크플로우 (10단계)

### Phase 1: 사업 (사전 단계)

| 단계 | 담당      | 설명                          |
|----|---------|-----------------------------|
| B1 | 사업 에이전트 | 문제 정의 → `docs/business/` 등록 |
| B2 | 사업 에이전트 | 가치/우선순위/로드맵 정의              |

### Phase 2: SDD (0~7단계)

| 단계 | 담당        | 설명                        |
|----|-----------|---------------------------|
| 0  | 작성자       | 작업 선택 → README.md 등록      |
| 1  | 작성자 → 검수자 | PRD 작성 → 검수               |
| 2  | 작성자 → 검수자 | 기능 설계 작성 → 검수             |
| 3  | 작성자 → 검수자 | Task (역할별) 작성 → 검수        |
| 4  | 작성자 → 검수자 | Development (역할별) 작성 → 검수 |
| 5  | 작성자       | 구현 + 테스트                  |
| 6  | 검수자       | 정적 분석/최종 리뷰               |
| 7  | 검수자       | 문서 이동 + 프로젝트 현황 동기화       |

---

## B1~B2 단계: 사업 에이전트

**담당**: 사업 에이전트 (Claude Code)
**산출물**: `docs/business/`

### B1: 문제 정의

1. **문제 식별**: 사용자/비즈니스 관점에서 해결할 문제 정의
2. **가치 평가**: 문제 해결 시 기대 효과
3. **우선순위 결정**: P0/P1/P2 기준으로 평가

### B2: 로드맵/지표 정의

1. **로드맵 배치**: 어느 마일스톤에 배치할지 결정
2. **성공 지표**: 측정 가능한 목표 정의

**핸드오프 체크리스트 (사업 → 작성자):**
- [ ] 문제가 명확히 정의되었는가?
- [ ] 가치/우선순위가 평가되었는가?
- [ ] `docs/business/`에 문서화되었는가?

---

## 0단계: 작업 선택

**담당**: 작성자

로드맵과 사업 문서를 확인한 뒤 작업을 선택하고 README.md에 등록한다.

1. **로드맵 확인**: `docs/business/6_roadmap/roadmap.md` 참조
2. **현 상태 확인**: `docs/business/STATUS.md` 참조
3. **참고 사업 문서 확인**: 사업 에이전트 핸드오프에서 지정한 문서와 확인 포인트 파악
4. **작업 선택**: 우선순위/의존성 고려
5. **README.md 등록**: `docs/specs/README.md`의 TARGET 섹션에 추가

**등록 형식:**
```markdown
- P{N} - {기능명}
  - PRD: `docs/specs/prd/{name}.md`
  - 기능 설계: `docs/specs/functional-design/{name}.md`
  - Task: `docs/specs/target/{functional|non-functional}/tasks/{name}.md`
  - Development: `docs/specs/target/{functional|non-functional}/development/`
```

---

## 1단계: PRD 작성

**담당**: 작성자 → 검수자

**흐름**: PRD 작성 (Draft) → 검수자 검수 → 승인 (Approved)

### PRD 내용

1. **배경 연결**: `docs/business/` 문서 참조
2. **목표/성공 기준**: 측정 가능한 목표 정의
3. **범위**: 포함/제외 명시
4. **사용자 시나리오**: 구체적인 사용 흐름
5. **요구사항**: Must/Should/Out 구분

**검수 체크리스트:**
- [ ] 문제/배경이 로드맵과 정합적인가?
- [ ] 목표/성공 기준이 명확하고 측정 가능한가?
- [ ] 범위(포함/제외)가 명시되어 있는가?
- [ ] 요구사항이 Must/Should/Out으로 구분되어 있는가?

---

## 2단계: 기능 설계 작성

**담당**: 작성자 → 검수자

**흐름**: 기능 설계 작성 (Draft) → 검수자 검수 → 승인 (Approved)

### 기능 설계 내용

1. **사용자 플로우**: 흐름, 상태 전이
2. **UI/UX**: 화면, 컴포넌트 (해당 시)
3. **데이터 모델**: 스키마 변경
4. **API/인터페이스**: 엔드포인트 정의
5. **테스트 시나리오**: 정상/예외 케이스

### 상세 수준

기능 설계는 **"어떻게 동작하는가"(동작 명세)** 수준만 기술합니다. 구현 상세는 Development 문서 또는 코드(SSoT)에 위임합니다.

| 유지 (동작 명세)           | 삭제 (구현 상세 → Development/코드)   |
|-----------------------|--------------------------------|
| API 필드 목록 (이름, 타입, 필수) | JSON 요청/응답 전문 예시              |
| 알고리즘 요약 (1줄)          | 의사코드 블록                       |
| 레이아웃 개념도 (ASCII 1개)   | CSS `@keyframes`, Tailwind 클래스 |
| 상태 전이 다이어그램           | TypeScript 인터페이스, 마이그레이션 SQL  |
| 테스트 시나리오 (정상/예외 핵심만)  | 파일 구조 목록, 중복 와이어프레임           |

**검수 체크리스트:**
- [ ] PRD의 요구사항이 기능 설계에 반영되어 있는가?
- [ ] 사용자 흐름/상태 전이가 명확한가?
- [ ] 데이터 모델/API가 구체적으로 정의되어 있는가?
- [ ] 예외/엣지 케이스가 처리되어 있는가?
- [ ] 구현 상세(JSON 전문, 의사코드 등)가 아닌 동작 명세 수준인가?

---

## 3단계: Task 작성 (역할별 분할)

**담당**: 작성자 → 검수자

**흐름**: Task 작성 (Draft) → 검수자 검수 → 승인 (Approved)

### Task 구조

Task는 **역할별로 업무를 분할**합니다:

```markdown
## 역할별 업무 분할

### 백엔드 개발자
| # | 업무 | 설명 | 의존성 |
|---|------|------|--------|
| B1 | API 엔드포인트 | ... | 없음 |
| B2 | DB 스키마 | ... | 없음 |

### 프론트엔드 개발자
| # | 업무 | 설명 | 의존성 |
|---|------|------|--------|
| F1 | 페이지 컴포넌트 | ... | B1 완료 후 |
| F2 | API 연동 | ... | B1 완료 후 |

### 디자이너 (해당 시)
| # | 업무 | 설명 | 의존성 |
|---|------|------|--------|
| D1 | UI 디자인 | ... | 없음 |
```

**검수 체크리스트:**
- [ ] 기능 설계의 요구사항이 업무 분할에 반영되어 있는가?
- [ ] 역할별 업무가 명확히 구분되어 있는가?
- [ ] 업무 간 의존성이 적절한가?

**검수자 검증 포인트:**
> 각 역할별 업무가 해당 분야의 rules (api.md, web.md, design.md) 기준에 맞는지 확인

---

## 4단계: Development 작성 (역할별)

**담당**: 작성자 → 검수자

**흐름**: Development 작성 (Draft) → 검수자 검수 → 승인 (Approved)

### Development 구조

Development는 **역할별로 별도 문서**를 작성합니다:

```
docs/specs/target/{functional|non-functional}/development/
├── {name}-backend.md      # 백엔드 구현 명세
├── {name}-frontend.md     # 프론트엔드 구현 명세
└── {name}-design.md       # 디자인 명세 (해당 시)
```

### Backend Development 내용

- 데이터 모델 (요청/응답)
- 비즈니스 로직
- 에러 처리
- 구현 대상 파일 (`apps/api/`)
- 테스트 시나리오

**검수 기준**: `.claude/rules/api.md`

### Frontend Development 내용

- 컴포넌트 구조
- 상태 관리
- API 연동
- 구현 대상 파일 (`apps/web/`)
- 테스트 시나리오

**검수 기준**: `.claude/rules/web.md`, `.claude/rules/design.md`

### Design Spec 내용 (해당 시)

- UI 컴포넌트
- 레이아웃/간격
- 색상/상태
- 접근성 체크리스트

**검수 기준**: `.claude/rules/design.md`

**검수자 검증 포인트:**
> 각 역할별 Development가 해당 분야의 rules 기준에 맞는지, Task의 업무와 1:1 대응되는지 확인

---

## 5단계: 구현 + 테스트

**담당**: 작성자

작성자가 모든 역할의 구현을 수행합니다.

**구현 순서:**
1. Backend (API, DB) - `api.md` 기준
2. Frontend (UI, 연동) - `web.md`, `design.md` 기준
3. 테스트 작성/실행

**체크리스트:**
- [ ] Development 문서와 구현이 정합하다
- [ ] 테스트 코드가 추가/갱신되었다
- [ ] 빌드가 성공한다

---

## 6단계: 정적 분석/최종 리뷰

**담당**: 검수자

**흐름:**
- 승인 → 상태: Approved
- 수정 필요 → 작성자 수정 → 6단계 반복

**역할별 검수:**

| 역할  | 검수 기준                 | 검수 포인트                   |
|-----|-----------------------|--------------------------|
| 백엔드 | `api.md`              | UseCase 패턴, 에러 처리, DB 정책 |
| 프론트 | `web.md`, `design.md` | 컴포넌트 구조, 디자인 일관성, 접근성    |

**체크리스트:**
- [ ] 기능/보안/회귀 리스크를 점검한다
- [ ] 각 역할별 rules 기준에 맞는가?
- [ ] 누락된 테스트/문서 갱신을 지적한다

---

## 7단계: 문서 이동 + 현황 동기화

**담당**: 검수자

### 문서 이동

모든 문서 Approved 후 `target/` → `current/` 이동

```bash
# 기능적 요구사항 완료 시
mv docs/specs/target/functional/tasks/{name}.md docs/specs/current/functional/tasks/
mv docs/specs/target/functional/development/{name}-*.md docs/specs/current/functional/development/
```

> **Note**: 비기능적 요구사항(non-functional)은 이동하지 않고 삭제한다.

### 문서 동기화 시 축약 규칙

개선 사항을 기존 기능 설계에 병합할 때, **구현 상세를 삭제하고 동작 명세 수준으로 축약**합니다.

1. **구현 상세 삭제**: JSON 전문, 의사코드, CSS 코드, Tailwind 클래스 등 제거
2. **대체된 섹션 통합**: 이전 기능을 대체하는 개선은 별도 섹션이 아닌 기존 섹션에 통합
3. **와이어프레임 정리**: 중복/중간 단계 와이어프레임 제거, 최종 개념도 1개만 유지

### 프로젝트 현황 동기화

**동기화 대상 문서:**

| 문서                     | 동기화 항목             |
|------------------------|--------------------|
| `README.md`            | 기술 스택, 구현 현황       |
| `docs/specs/README.md` | TARGET/CURRENT 인덱스 |
| `.claude/CLAUDE.md`    | 구조, 명령어            |
| `.claude/rules/*.md`   | 패턴/정책 변경 시         |

---

## 문서 분류 기준

| 분류                 | 설명                   | 예시          |
|--------------------|----------------------|-------------|
| **functional**     | 사용자가 직접 사용하는 비즈니스 기능 | 로그인, 출석 관리  |
| **non-functional** | 아키텍처, 성능, 보안, 유지보수성  | 에러 처리, 리팩토링 |

---

## 비기능적 요구사항 처리 방식

비기능적 요구사항(non-functional)은 **간소화된 워크플로우**를 따릅니다.

### 이유

- 완료 후에는 **코드베이스 자체가 SSoT** 역할
- 별도 SDD 문서(Task/Development) 유지 시 불일치 발생 가능
- 아키텍처/인프라 변경은 코드와 CLAUDE.md로 충분히 추적 가능

### 간소화된 워크플로우

```
기능 설계 작성 → 검수 → 구현 → 검수 → 문서 갱신
```

| 단계 | 담당        | 설명                                    |
|----|-----------|---------------------------------------|
| 1  | 작성자 → 검수자 | 기능 설계 작성 → 검수                         |
| 2  | 작성자       | **바로 구현** (Task/Development 생략)       |
| 3  | 검수자       | 정적 분석/최종 리뷰                           |
| 4  | 검수자       | 프로젝트 현황 동기화 (CLAUDE.md, README.md 갱신) |

### 생략되는 문서

- `target/non-functional/features/*.md`
- `target/non-functional/tasks/*.md`
- `target/non-functional/development/*.md`

### 유지되는 문서

- `functional-design/*.md` - 기능 설계 (상태: Approved 후 유지)

### 문서 갱신 대상

| 변경 내용         | 갱신 대상                            |
|---------------|----------------------------------|
| API 아키텍처 변경   | `.claude/rules/api.md`           |
| 웹 앱 구조 변경     | `.claude/rules/web.md`           |
| 빌드/명령어 변경     | `.claude/CLAUDE.md`              |
| 기술 스택/환경변수 추가 | `.claude/CLAUDE.md`, `README.md` |

---

## 상태 규칙

| 상태           | 의미        |
|--------------|-----------|
| **Draft**    | 작성 초기 상태  |
| **Review**   | 검수자에게 전달됨 |
| **Approved** | 검수 완료     |

---

## 예외 처리

| 상황          | 처리                           |
|-------------|------------------------------|
| **소규모 변경**  | Task/Development 없이 바로 구현 가능 |
| **UI만 변경**  | Frontend Development만 작성     |
| **API만 변경** | Backend Development만 작성      |
| **긴급 대응**   | 구현 후 문서 보강                   |

---

## 핸드오프 규칙

핸드오프 내용은 **파일로 작성하지 않고 화면에 직접 출력**합니다.

```markdown
---
## 검수자 핸드오프: [작업명]

### 완료된 작업
- ...

### 변경된 파일
- ...

### 검수 항목
- [ ] ...

### 역할별 검수 기준
- 백엔드: api.md
- 프론트: web.md, design.md
---
```

---

## 부록: 기능 개선 시 문서 병합

기존 기능에 개선 사항을 추가할 때는 **별도 문서를 생성하지 않고 기존 문서에 병합**합니다.

**도메인별 메인 문서:**

| 도메인   | 기능 설계                      | Task/Development           |
|-------|----------------------------|----------------------------|
| 출석    | `attendance-management.md` | `attendance-management.md` |
| 학생    | `student-management.md`    | `student-management.md`    |
| 그룹    | `group-management.md`      | `group-management.md`      |
| 통계    | `statistics.md`            | `statistics.md`            |
| 인증/계정 | `auth-account.md`          | `auth-account.md`          |

**병합 절차:**
1. 기존 문서 확인
2. 개선 내용을 새 섹션으로 추가
3. 섹션 제목에 출처 명시 (예: "### 달력 UI (로드맵 1단계)")


# PRD: 주일학교 출석부 프로그램

> PM 에이전트가 작성하는 제품 요구사항 문서입니다.
> 기존 구현된 기능을 기반으로 역산정하여 작성되었습니다.

## 배경/문제 요약

- **참고**: `docs/business/README.md`
- **문제**:
  - 매년 엑셀로 된 출석부를 다시 만들어야 해서 학생 정보 재입력에 많은 시간 소요
  - 파일 기반 관리로 인해 출석 현황이 각자 달라지는 데이터 불일치 문제
  - 출석 통계를 수동으로 집계해야 하는 비효율
  - 파일을 가진 사람만 출석 체크가 가능한 접근성 문제
- **현재 상태**: 엑셀 기반 수동 관리
- **목표 상태**: 웹 기반 중앙 집중식 출석 관리 시스템

## 목표/성공 기준

- **목표**:
  - 매년 반복되는 출석부 재생성 작업 제거
  - 언제 어디서나 출석 체크 및 확인 가능
  - 출석 데이터의 단일 진실 공급원(SSoT) 확보
  - 출석 통계 자동 산출
- **성공 지표**:
  - 출석부 재생성 시간: 연간 수 시간 → 0
  - 데이터 불일치 발생: 빈번 → 0
  - 출석 통계 산출 시간: 수동 집계 → 즉시 조회
- **측정 기간**: 서비스 운영 시작 (2022.03~) 이후 지속

## 사용자/대상

- **주요 사용자**:
  - 교리교사 (1차): 출석 체크, 학생 관리
  - 관리자 (2차): 전체 현황 파악, 통계 조회
- **사용 맥락**:
  - 매주 주일학교 시간에 출석 체크
  - 학기 초/말 학생 정보 갱신
  - 연말 졸업/진급 처리
  - 출석 우수 학생 시상 대상 선정

## 범위

### 포함

- **인증**: 계정별 로그인, 회원가입, 토큰 기반 인증
- **그룹 관리**: 그룹(학년/반) CRUD
- **학생 관리**: 학생 정보 CRUD, 검색, 졸업/진급 처리
- **출석 관리**: 그룹별 출석 현황 조회, 일괄 입력/삭제
- **통계**: 연도별 우수 출석 학생 조회

### 제외

- **현재 스코프 외**:
  - Refresh Token (Access Token만 사용)
  - 계정 수정/삭제 (DB 직접 관리)
  - 다중 계정 권한 관리
  - 행사(캠프/피정) 운영
  - 알림/리마인드 기능

## 사용자 시나리오

1. **로그인**: 교사가 ID/비밀번호로 로그인하여 본인 계정의 그룹에 접근
2. **그룹 확인**: 담당 그룹 목록을 확인하고 필요시 그룹 추가/수정/삭제
3. **학생 관리**: 그룹에 속한 학생 명단을 조회하고 신규 학생 등록 또는 정보 수정
4. **출석 체크**: 매주 해당 그룹의 출석 현황 화면에서 학생별 출석 입력
5. **통계 조회**: 연말에 출석 우수 학생 목록을 조회하여 시상 대상 선정
6. **졸업/진급**: 연말에 졸업/진급 처리를 실행하여 학생 그룹 일괄 이동

## 요구사항

### 필수 (Must)

- [x] 계정별 로그인 및 Access Token 발급
- [x] 토큰 기반 인증으로 보호된 API 접근
- [x] 계정별 그룹 목록 조회
- [x] 그룹 생성/조회/수정/삭제 (소프트 삭제)
- [x] 그룹별 학생 목록 및 출석 현황 조회
- [x] 학생 목록 조회 (페이지네이션, 검색)
- [x] 학생 생성/조회/수정/삭제
- [x] 출석 데이터 일괄 입력/삭제
- [x] 연도별 출석 캘린더 (토요일/일요일) 제공
- [x] 우수 출석 학생 통계 조회

### 선택 (Should)

- [x] 졸업/진급 일괄 처리
- [ ] Refresh Token 기반 인증 갱신 (TARGET에 등록됨)

### 로드맵 1단계 (무료 핵심 완성)

> 참고: `docs/business/6_roadmap/roadmap.md`

- [x] **대시보드 통계**: 대시보드에서 통계 카드 표시
  - 주간/월간 출석률
  - 이번 주 출석 현황
  - 성별 출석 분포
  - 그룹별 출석률 순위 TOP 5
  - 그룹별/전체 우수 출석 학생 TOP 5
- [x] **출석부 자동 저장**: 셀 변경 즉시 자동 저장
- [x] **출석부 달력 UI**: 달력 형태로 출석부 UI 개편
  - 날짜 클릭 → 모달에서 출석 입력
  - 미사/교리 체크박스 (◎○△ 표기)
  - 의무축일 표시 (천주교 전례력)
- [x] **일괄 졸업 처리**: 학생 다중 선택 후 졸업 처리
  - 소프트 처리 (데이터 보존)
  - 졸업생 필터로 조회
- [x] **그룹 관리 UI/UX 개선**: 그룹 목록/상세 화면 개편
  - 그룹 클릭 → 상세 페이지 이동 (그룹 정보 + 학생 목록)
  - 일괄 삭제 (다중 선택)
  - 테이블 UI 유지 + 디자인 정리
  - (인라인 수정은 추후 구현)
- [x] **학생 관리 UI/UX 개선**: 학생 목록/상세 화면 개편
  - 학생 클릭 → 상세 페이지 이동 (학생 정보)
  - 일괄 삭제 (다중 선택, 소프트 삭제, 복구 가능)
  - 삭제된 학생 필터로 조회
  - 테이블 UI 유지 + 디자인 정리
  - (인라인 수정은 추후 구현)
- [x] **회원가입**: 신규 사용자가 스스로 계정 생성
  - ID 중복 확인 (4~20자, 영문 소문자/숫자)
  - 이름 입력 (2~20자)
  - 비밀번호 입력 (8자 이상) + 확인
  - 가입 성공 시 자동 로그인 → 대시보드 이동
  - 로그인 화면에 회원가입 링크 추가
- [ ] **목록 페이지네이션 상태 유지**: 상세 페이지에서 목록으로 복귀 시 이전 페이지 유지
  - 학생 목록: 상세→목록 복귀 시 기존 페이지 번호 유지
  - 그룹 목록: 상세→목록 복귀 시 기존 페이지 번호 유지
  - URL 쿼리 파라미터로 페이지 상태 동기화 (`?page=N`)
  - 브라우저 뒤로가기에서도 페이지 상태 보존

### UI/UX 요구사항

- [ ] **중앙 정렬 레이아웃**: 모든 페이지의 주요 콘텐츠가 화면 중앙에 정렬되어야 함
  - 필터 영역 (그룹/연도 선택 등)
  - 폼 영역 (입력 필드, 버튼)
  - 테이블/카드 컨테이너

### 보류 (Hold)

| 기능             | 사유                |
|----------------|-------------------|
| 학생 엑셀 Import   | 임팩트 검증 필요, 피드백 대기 |
| 출석 리포트 (주간/월간) | 대시보드 통계로 대체       |

### 제외 (Out)

- 계정 자체 관리 (생성/수정/삭제)
- 다중 권한 체계 (관리자/교사/뷰어 등)
- 실시간 알림
- 모바일 앱

## 제약/가정/리스크

- **제약**:
  - 모든 API 응답은 HTTP 200으로 내려가며 `code` 필드로 성공/실패 구분
  - 계정 수정/삭제는 DB 직접 접근으로만 가능
- **가정**:
  - 사용자는 현대적인 웹 브라우저 사용
  - 동시 접속자 수는 소규모 (수십 명 이내)
- **리스크**:
  - Access Token만 사용하여 토큰 탈취 시 보안 취약
  - 계정별 데이터 격리가 완벽하지 않을 수 있음 (소유권 검증 미흡)

## 의존성

- **내부**:
  - MySQL 데이터베이스
  - Express + tRPC 서버
  - Prisma ORM
- **외부**:
  - JWT 라이브러리 (jsonwebtoken)
  - bcrypt (비밀번호 해싱)

## 롤아웃/검증

- **출시 단계**: 2022.03 첫 배포 완료, 지속 운영 중
- **이벤트/로그**: 서버 로그 기반 모니터링
- **검증 방법**: 실제 주일학교 운영에서 사용 검증 완료

## 오픈 이슈

- [ ] Refresh Token 도입 (보안 강화) → TARGET 등록됨 (`auth-refresh-token`)
- [ ] 계정별 데이터 소유권 검증 강화 → TARGET 등록됨 (`auth-ownership-validation`)
- [ ] 웹 페이지 React 마이그레이션 → TARGET 등록됨 (`web-page-migration`)

## 연결 문서

- 사업 문서: `docs/business/README.md`
- 기능 설계 (도메인별 단일 문서):
  - `docs/specs/functional-design/auth-account.md`
  - `docs/specs/functional-design/group-management.md` (일괄 삭제 포함)
  - `docs/specs/functional-design/student-management.md` (일괄 삭제/복구 + 졸업 처리 + 엑셀 Import 포함)
  - `docs/specs/functional-design/attendance-management.md` (달력 UI + 자동 저장 포함)
  - `docs/specs/functional-design/statistics.md` (우수 출석 + 대시보드 통계 포함)
- Feature (구현 완료):
  - `docs/specs/current/functional/features/auth-account.md`
  - `docs/specs/current/functional/features/group-management.md`
  - `docs/specs/current/functional/features/student-management.md`
  - `docs/specs/current/functional/features/attendance-management.md`
  - `docs/specs/current/functional/features/statistics.md`

---

**작성일**: 2026-01-13
**작성자**: PM 에이전트
**상태**: Approved

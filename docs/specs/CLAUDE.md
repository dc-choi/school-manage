# CLAUDE.md - SDD (Spec-Driven Development)

> **용도**: PRD, 기능 설계, Feature/Task/Development 문서 작성 규칙
> **언제 읽나**: SDD 문서 작성/검수, PM 역할 수행 시
> **스킵 조건**: 코드 구현, API/웹 개발 작업 시

이 문서는 `docs/specs/` 폴더에서 작업할 때 참고하는 SDD 가이드입니다.

## PM 문서 범위
- 본 문서는 PRD, 기능 설계, 기술 상세 등 PM 관점 산출물을 기록한다.
- 문제 정의/가치/우선순위/로드맵/지표는 `docs/business/`에서 관리한다. (가이드: `docs/business/CLAUDE.md`)
- 템플릿 파일: `docs/specs/templates/prd.md`, `docs/specs/templates/functional_design.md`

## PM 에이전트 역할

PM 에이전트는 **사업 에이전트와 SDD 작성자 사이를 조율하는 역할**입니다.

```
[사업 에이전트]  ←→  [PM 에이전트]  ←→  [SDD 작성자]
   (Why)              (What)           (How)
  문제/가치          요구사항/설계        구현/테스트
```

| 역할          | 관점       | 질문              | 산출물                  |
|-------------|----------|-----------------|----------------------|
| 사업 에이전트     | **Why**  | "왜 이걸 해야 하는가?"  | 문제 정의, 로드맵           |
| **PM 에이전트** | **What** | "무엇을 만들어야 하는가?" | PRD, 기능 설계           |
| SDD 작성자     | **How**  | "어떻게 구현할 것인가?"  | Feature/Task/Dev, 코드 |

### 핵심 책임

1. **번역**: 사업 관점의 문제를 개발 가능한 요구사항으로 변환
2. **구체화**: 추상적인 목표를 측정 가능한 기능으로 정의
3. **우선순위 조율**: 사업 가치와 개발 복잡도를 고려한 작업 순서 결정
4. **핸드오프**: SDD 작성자가 바로 작업할 수 있는 수준의 명세 전달

## PM 에이전트 입력 소스

PM 에이전트는 다음 세 가지 소스에서 작업을 도출합니다:

| 소스                | 설명                                 | 예시                             |
|-------------------|------------------------------------|--------------------------------|
| **사업 에이전트 산출물**   | `docs/business/`에 정의된 기능/로드맵       | 로드맵의 "출석 UX 개선", "엑셀 Import" 등 |
| **사용자 직접 요구**     | 사용자가 명시적으로 요청한 기능                  | "중앙 정렬 기능 추가해줘"                |
| **기존 TARGET 태스크** | `docs/specs/README.md`에 등록된 미완료 작업 | DEPLOY P0, SECURITY P1 등       |

### PM의 우선순위 조율

PM은 위 세 가지 소스를 종합하여 **다음 작업 순서를 결정**합니다:

1. 사업 로드맵의 단계별 목표 확인
2. 기존 TARGET 태스크의 의존성/블로커 파악
3. 사용자 요구사항 반영
4. 사업 가치 + 개발 복잡도를 고려한 우선순위 조율

### 금지 사항

- PM 에이전트가 **임의로 기능을 창작하지 않는다**
- 사용자가 모호하게 언급한 내용(예: "디자인이 별로")을 PM이 해석해서 기능화하지 않는다
- 반드시 **사용자에게 구체적인 요구사항을 확인**한 후 문서화한다
- **사용자의 기능 컨펌 없이 기능 설계를 작성하지 않는다**

### 기능 설계 전 필수 절차

1. **기능 제안**: PM이 로드맵/사용자 요구 기반으로 기능 목록 제안
2. **사용자 컨펌**: 사용자가 각 기능의 범위/방향을 확정
3. **PRD 작성**: 컨펌된 내용을 기반으로 PRD 작성
4. **PRD 검수**: 검수자가 PRD 검수 → 승인/수정 요청
5. **기능 설계 작성**: PRD 승인 후 기능 설계 작성
6. **기능 설계 검수**: 검수자가 기능 설계 검수 → 승인/수정 요청

```
[PM: 기능 제안]
    ↓
[사용자: 컨펌/수정 요청]
    ↓
[PM: PRD 작성]
    ↓
[검수자: PRD 검수] → 수정 필요 시 → [PM: PRD 수정]
    ↓ 승인
[PM: 기능 설계 작성]
    ↓
[검수자: 기능 설계 검수] → 수정 필요 시 → [PM: 기능 설계 수정]
    ↓ 승인
[SDD 작성자: Feature/Task/Development 작성]
```

> **중요**: 사용자가 "진행해"라고 해도, 각 기능의 세부 내용을 먼저 확인받아야 한다. 사용자에게는 PM이 모르는 구체적인 생각이 있을 수 있다.
> **중요**: PRD/기능 설계는 검수자 승인 후에만 SDD 작성자에게 전달된다.

### 올바른 워크플로우

```
[사용자 모호한 언급]
    ↓
[PM: 구체적 요구사항 질문]
    ↓
[사용자: 명시적 기능 요구]
    ↓
[PM: PRD 작성] → [검수자: PRD 검수] → 승인
    ↓
[PM: 기능 설계 작성] → [검수자: 기능 설계 검수] → 승인
    ↓
[SDD 작성자: Feature/Task/Development 작성]
```

## Spec-Driven Development 개요

이 프로젝트는 **Spec-anchored** 수준의 SDD를 적용합니다. 코드 작성 전에 명세서를 먼저 작성하고, 명세서가 AI와 개발자 모두의 **단일 진실 공급원(Single Source of Truth)** 역할을 합니다.

### SDD 레벨 정의

| 레벨                | 설명          | 특징                |
|-------------------|-------------|-------------------|
| **Spec-first**    | 명세 → 구현 단방향 | 코드 작성 전 명세 필수     |
| **Spec-anchored** | 명세 ↔ 코드 양방향 | 코드 변경 시 명세 동기화 필수 |

### Spec-anchored 핵심 원칙

1. **양방향 동기화**: 명세 → 코드, 코드 → 명세 모두 일관성 유지
2. **기존 문서 병합**: 기능 개선 시 새 문서가 아닌 기존 문서에 병합
3. **추적성 확보**: 모든 변경의 근거가 문서에 명시되어야 함
4. **완전성 검증**: PRD → 기능 설계 → Feature → Task → Development → 코드까지 체인 일치

### 코드-문서 동기화 규칙

| 변경 유형                 | 처리 방식                                        |
|-----------------------|----------------------------------------------|
| **새 기능 추가**           | PRD/기능 설계 → Feature/Task/Development 작성 → 구현 |
| **기존 기능 개선**          | 기존 Feature/Task/Development 문서에 병합 → 구현      |
| **버그 수정**             | 직접 수정 (SDD 불필요), 단 구조적 변경 시 문서 갱신            |
| **코드 변경 후 문서 불일치 발견** | 검수자가 문서 갱신 필수                                |

### 전체 문서 체인 동기화

Spec-anchored에서는 **SDD 문서(Feature/Task/Development)뿐만 아니라 PRD와 기능 설계도 함께 동기화**합니다.

**동기화 대상 문서 체인:**
```
PRD (체크리스트 갱신)
    ↓
기능 설계 (상태/경로 갱신)
    ↓
Feature/Task/Development (내용 병합)
    ↓
README.md (인덱스 갱신)
```

**기능 구현 완료 시 갱신 항목:**

| 문서          | 갱신 항목                                                             |
|-------------|-------------------------------------------------------------------|
| PRD         | 로드맵 체크리스트 (`- [ ]` → `- [x]`)                                     |
| 기능 설계       | 도메인별 메인 문서에 병합, 파생 문서 삭제, 상태 갱신 (`Draft` → `Approved`), SDD 경로 갱신 |
| Feature     | 도메인별 메인 문서에 병합, 파생 문서 삭제, 상위 문서 참조에 기능 설계 추가                      |
| Task        | 도메인별 메인 문서에 병합, 파생 문서 삭제, 상위 문서 참조에 기능 설계 추가                      |
| Development | 도메인별 메인 문서에 병합, 파생 문서 삭제, 상위 문서 참조에 기능 설계 추가                      |
| README.md   | 인덱스 테이블 갱신, 비고 컬럼에 병합 표기                                          |

### 기능 개선 시 문서 병합 규칙

기존 기능에 개선 사항을 추가할 때:

> **중요**: 이 규칙은 **기능 설계 문서와 SDD 문서(Feature/Task/Development) 모두에 적용**됩니다.

1. **별도 문서 생성 금지**: `attendance-calendar-ui.md` 같은 파생 문서 X
2. **기존 문서에 병합**: `attendance-management.md`에 통합
3. **병합 표기**: 섹션 제목에 "(로드맵 N단계)" 등 출처 명시
4. **참조 문서 갱신**: PRD, README.md 동시 업데이트

**도메인별 메인 문서:**

| 도메인 | 기능 설계 | SDD |
|-------|---------|-----|
| 출석 | `attendance-management.md` | `attendance-management.md` |
| 학생 | `student-management.md` | `student-management.md` |
| 그룹 | `group-management.md` | `group-management.md` |
| 통계 | `statistics.md` | `statistics.md` |
| 인증/계정 | `auth-account.md` | `auth-account.md` |

**잘못된 예시 (별도 문서 생성):**
```
docs/specs/functional-design/
├── attendance-management.md      # 메인
├── attendance-auto-save.md       # ❌ 파생 문서
└── attendance-calendar-ui.md     # ❌ 파생 문서
```

**올바른 예시 (메인 문서에 병합):**
```
docs/specs/functional-design/
└── attendance-management.md      # 메인 (자동 저장, 달력 UI 섹션 포함)
    ├── ## 기본 출석 관리
    ├── ## 달력 UI (로드맵 1단계)
    └── ## 자동 저장 (로드맵 1단계)
```

## 4개 세션 구조

```
[사업 에이전트]     [PM 에이전트]        [SDD 작성자]       [SDD 검수자]
 Claude Code   →   Claude Code    →   Claude Code   ↔   Claude Code
  (세션 1)          (세션 2)           (세션 3)          (세션 4)
docs/business/    PRD + 기능 설계      Feature/Task/      검수 + 승인
                                    Development + 구현
```

## 역할 분리

| 세션 | 역할          | 도구          | 책임                            | 산출물 위치                                             |
|----|-------------|-------------|-------------------------------|----------------------------------------------------|
| 1  | **사업 에이전트** | Claude Code | 문제 정의, 가치, 우선순위               | `docs/business/`                                   |
| 2  | **PM 에이전트** | Claude Code | PRD, 기능 설계                    | `docs/specs/prd/`, `docs/specs/functional-design/` |
| 3  | **SDD 작성자** | Claude Code | Feature/Task/Development + 구현 | `docs/specs/target/` → `apps/`                     |
| 4  | **SDD 검수자** | Claude Code | 각 단계별 검수 + 최종 승인              | `docs/specs/`                                      |

| 단계             | 담당          | 산출물                                                             |
|----------------|-------------|-----------------------------------------------------------------|
| 문제 정의          | **사업 에이전트** | 문제 식별, 가치, 우선순위 (`docs/business/`)                              |
| PRD/기능 설계      | **PM 에이전트** | PRD, 기능 설계 (`docs/specs/prd/`, `docs/specs/functional-design/`) |
| Feature 문서     | **SDD 작성자** | 요구사항, 사용자 스토리, 인수 조건                                            |
| Task 문서        | **SDD 작성자** | 유스케이스, 엣지 케이스, 검증 체크리스트                                         |
| Development 문서 | **SDD 작성자** | 로직, 검증 규칙, 테스트 시나리오                                             |
| 구현             | **SDD 작성자** | Development 문서 기준으로 코드 작성                                       |
| 검수             | **SDD 검수자** | 각 단계별 검수 + 최종 승인                                                |

## 전체 워크플로우

### Phase 1: 사업/PM (사전 단계)

| 단계   | 담당                    | 설명                                         |
|------|-----------------------|--------------------------------------------|
| B1   | 사업 에이전트 (Claude Code) | 문제 정의 → `docs/business/` 등록                |
| B2   | 사업 에이전트 (Claude Code) | 가치/우선순위/로드맵 정의                             |
| P1   | PM 에이전트 (Claude Code) | PRD 작성 → `docs/specs/prd/`                 |
| P1-R | 검수자 (Claude Code)     | PRD 검수 → 승인/수정 요청                          |
| P2   | PM 에이전트 (Claude Code) | 기능 설계 작성 → `docs/specs/functional-design/` |
| P2-R | 검수자 (Claude Code)     | 기능 설계 검수 → 승인/수정 요청                        |

> **Note**: PM 산출물도 검수자 검수를 거쳐야 SDD 작성자에게 전달됩니다.

### Phase 2: SDD (9단계: 0~8)

| 단계 | 담당            | 설명                       |
|----|---------------|--------------------------|
| 0  | 사용자 (작성자 서포트) | 작업 선택 → README.md 등록     |
| 1  | 사용자 (작성자 서포트) | PRD/기능 설계 기반 범위 확정       |
| 2  | 작성자 → 검수자     | Feature 작성 → 검수          |
| 3  | 작성자 → 검수자     | Task 작성 → 검수             |
| 4  | 작성자 → 검수자     | Development 작성 → 검수      |
| 5  | 작성자           | 구현 + 테스트                 |
| 6  | 검수자           | 정적 분석/최종 리뷰              |
| 7  | 검수자           | 문서 이동 (target → current) |
| 8  | 검수자           | 프로젝트 현황 동기화              |

> **Note**: 사업/PM 단계(B1~P2)가 선행되지 않은 경우, SDD 0단계에서 직접 문제 정의 가능

상세 워크플로우: `docs/specs/WORKFLOW.md`

## 스펙 문서 구조

```
docs/specs/
├── prd/                  # PM 에이전트 산출물: PRD 문서
├── functional-design/    # PM 에이전트 산출물: 기능 설계 문서
├── current/              # 완료된 기능 명세 (SSoT) - 기능적 요구사항만
│   └── functional/       # 비즈니스 기능 (로그인, 출석 등)
│       ├── features/
│       ├── tasks/
│       ├── development/
│       └── reviews/
├── target/               # 개선/이행 예정 명세
│   ├── functional/
│   └── non-functional/   # 완료 후 삭제됨 (current로 이동 안 함)
└── templates/            # 문서 템플릿
    ├── feature.md
    ├── task.md
    ├── development.md
    ├── prd.md
    └── functional_design.md
```

## 언제 SDD를 적용하는가?

| 작업 유형         | SDD 적용                           |
|---------------|----------------------------------|
| 새 기능 개발       | O (Feature → Task → Development) |
| 중간 규모 변경      | O (Task → Development)           |
| 버그 수정 / 작은 변경 | X (직접 수정)                        |

## 문서 작성 규칙

### 문서 간 계층 구조

```
PRD (무엇을 왜 만드는가)
  ↓
기능 설계 (어떻게 동작하는가)
  ↓
Feature (무엇을 만드는가 - 요구사항 정의)
  ↓
Task (어떻게 업무를 나누는가 - 업무 분할/순서)
  ↓
Development (무엇을 구현하는가 - 세부 구현 내용)
  ↓
구현 (코드 작성)
```

각 문서는 상위 문서를 참조하며, 검수자는 이 계층 구조를 따라 **요구사항 추적성**을 검증합니다.

### Feature 문서
- **질문**: "무엇을 만드는가?"
- **목적**: PRD/기능 설계의 요구사항을 **검증 가능한 형태**로 정의
- **핵심 내용**: 사용자 스토리, 기능 요구사항, 인수 조건, 엣지 케이스
- **상위 문서 참조**: PRD, 기능 설계
- **검수 포인트**: PRD의 Must Have가 모두 포함되었는지
- **템플릿**: `docs/specs/templates/feature.md`

### Task 문서
- **질문**: "어떻게 업무를 나누는가?"
- **목적**: Feature의 요구사항을 **구현 가능한 단위로 분할**하고 순서/의존성 정의
- **핵심 내용**: 업무 분할 테이블, 유스케이스, 검증 체크리스트
- **상위 문서 참조**: PRD, 기능 설계, Feature
- **검수 포인트**: Feature의 요구사항이 빠짐없이 업무로 분할되었는지
- **템플릿**: `docs/specs/templates/task.md`

### Development 문서
- **질문**: "무엇을 구현하는가?"
- **목적**: Task의 업무를 수행하기 위한 **세부 구현 내용** 정의
- **핵심 내용**: 구현 대상 업무, 데이터 모델, 비즈니스 로직, 테스트 시나리오
- **상위 문서 참조**: PRD, 기능 설계, Feature, Task
- **검수 포인트**: Task의 업무 분할과 기능 설계의 인터페이스가 정확히 반영되었는지
- **특징**: 특정 언어/프레임워크에 종속되지 않는 의사코드 사용
- **템플릿**: `docs/specs/templates/development.md`

### Review 문서
- **목적**: 정적 분석 리뷰 결과 기록
- **파일명**: `YYYYMMDD-{feature-name}-review.md`
- **필수 섹션**: 분석 대상, 발견 사항 (Critical/Major/Minor), 테스트 커버리지, 보안 점검, 구현 요약
- **검수 포인트**: PRD/기능 설계/Feature의 요구사항이 모두 구현되었는지

## PM 문서 작성 가이드

### PRD 체크리스트
- 문제/배경이 `docs/business/`의 문제 정의와 정합적인가
- 대상 사용자/사용 맥락이 명확한가
- 목표/성공 기준이 정량화되어 있는가(지표, 기간)
- 범위(포함/제외)가 명시돼 있는가
- 핵심 사용자 시나리오/스토리가 있는가
- 요구사항이 Must/Should/Out으로 구분돼 있는가
- 제약/가정/리스크가 기록돼 있는가
- 측정/로그/검증 계획이 포함돼 있는가
- 오픈 이슈와 결정 필요 사항이 정리돼 있는가

### 기능 설계 체크리스트
- 사용자 흐름/상태 전이가 설명돼 있는가
- 화면/컴포넌트(해당 시)와 권한별 뷰가 정의돼 있는가
- 데이터 모델/스키마 변경과 마이그레이션이 정리돼 있는가
- API/이벤트 인터페이스가 정의돼 있는가
- 권한/보안 요구사항이 명시돼 있는가
- 예외/엣지 케이스 처리가 포함돼 있는가
- 성능/제약/레이트 리밋 등 한계가 명시돼 있는가
- 로그/모니터링 포인트와 테스트 시나리오가 있는가

### PRD 템플릿
```markdown
# PRD: {기능/프로젝트명}

## 배경/문제 요약
- 참고: `docs/business/...`

## 목표/성공 기준
- 목표:
- 성공 지표:
- 측정 기간:

## 사용자/대상
- 주요 사용자:
- 사용 맥락:

## 범위
### 포함
- ...
### 제외
- ...

## 사용자 시나리오
1) ...
2) ...

## 요구사항
### 필수 (Must)
- ...
### 선택 (Should)
- ...
### 제외 (Out)
- ...

## 제약/가정/리스크
- 제약:
- 가정:
- 리스크:

## 의존성
- 내부:
- 외부:

## 롤아웃/검증
- 출시 단계:
- 이벤트/로그:
- 검증 방법:

## 오픈 이슈
- ...
```

### 기능 설계 템플릿
```markdown
# 기능 설계: {기능명}

## 연결 문서
- PRD:
- Feature:
- Task:
- Development:

## 흐름/상태
- 사용자 플로우:
- 상태 전이:

## UI/UX (해당 시)
- 화면/컴포넌트:
- 권한별 차이:

## 데이터/도메인 변경
- 엔티티/스키마:
- 마이그레이션:

## API/인터페이스
- 엔드포인트/이벤트:
- 요청/응답:

## 권한/보안
- 접근 제어:
- 감사/로그:

## 예외/엣지 케이스
- ...

## 성능/제약
- ...

## 측정/모니터링
- 이벤트:
- 알림/경보:

## 테스트 시나리오
- ...
```

## 문서 상태 관리

| 상태           | 의미                 |
|--------------|--------------------|
| **Draft**    | 작성 초기 상태           |
| **Review**   | 핸드오프 완료, 검토 진행     |
| **Approved** | 검수 완료, 다음 단계 진행 가능 |

### 상태 전이 주체

| 문서 유형       | Draft → Review | Review → Approved |
|-------------|----------------|-------------------|
| **PRD**     | PM 에이전트        | 검수자               |
| **기능 설계**   | PM 에이전트        | 검수자               |
| Feature     | SDD 작성자        | 검수자               |
| Task        | SDD 작성자        | 검수자               |
| Development | SDD 작성자        | 검수자               |
| 구현 코드       | SDD 작성자        | 검수자               |

> **Note**: PRD/기능 설계도 검수자 승인이 필요합니다.

## 우선순위 기준

| 우선순위 | 의미           |
|------|--------------|
| P0   | 즉시 필요 (블로커)  |
| P1   | 중요 (다음 마일스톤) |
| P2   | 개선 (여유 있을 때) |

## 문서 이동 규칙

### 기능적 요구사항 (functional)

모든 문서(Feature, Task, Development, Review)가 Approved 상태가 되면:
1. `target/` → `current/`로 이동
2. 문서 내 경로 참조 업데이트 (`target/` → `current/`)
3. `docs/specs/README.md` 인덱스 업데이트

### 비기능적 요구사항 (non-functional)

1. **리뷰 문서 생성하지 않음**
2. `target/` 문서를 **삭제** (current로 이동하지 않음)
3. 관련 CLAUDE.md, README.md 등에 변경 사항 반영

> 상세 내용: `docs/specs/WORKFLOW.md`의 "비기능적 요구사항 처리 방식" 참조

## 서브 에이전트 활용 가이드

Claude Code의 서브 에이전트를 활용하면 SDD 워크플로우에서 **작성자 역할의 효율성**을 높일 수 있습니다.

> **주의**: 서브 에이전트는 검수자의 독립적 관점을 대체할 수 없습니다. 6단계 검수는 별도 세션 유지를 권장합니다.

### 사용 가능한 에이전트

| 에이전트                | 용도          | 예시 요청                |
|---------------------|-------------|----------------------|
| **Explore**         | 코드베이스 탐색/분석 | "tRPC 라우터 구조 파악해줘"   |
| **Plan**            | 구현 계획 수립    | "이 기능 어떻게 구현할지 설계해줘" |
| **Bash**            | 명령어 실행, Git | "테스트 돌려줘", "커밋해줘"    |
| **general-purpose** | 복잡한 멀티스텝 작업 | "이 버그 원인 찾아서 수정해줘"   |

### 워크플로우 단계별 활용

| 단계             | 활용 방법                               | 요청 예시                            |
|----------------|-------------------------------------|----------------------------------|
| 0단계 (문제 정의)    | Explore로 코드베이스 분석                   | "개선이 필요한 부분 분석해줘"                |
| 1단계 (작업 선택)    | Explore로 의존성/영향 범위 파악               | "이 작업의 영향 범위 파악해줘"               |
| 2~4단계 (문서 작성)  | Explore + Plan 병렬 활용                | "api와 trpc 병렬로 분석해줘"             |
| 5단계 (구현)       | Bash 백그라운드 실행                       | "백그라운드로 테스트 워치 모드 실행해줘"          |
| 6단계 (정적 분석)    | Bash 병렬 실행 (lint, typecheck, build) | "lint, typecheck, build 병렬로 돌려줘" |
| 7~8단계 (이동/동기화) | Bash + Explore                      | "문서 이동하고 현황 동기화해줘"               |

### 핵심 키워드

| 키워드          | 효과              |
|--------------|-----------------|
| **"병렬로"**    | 여러 에이전트 동시 실행   |
| **"백그라운드로"** | 작업 실행하고 다른 일 계속 |
| **"분석해줘"**   | Explore 에이전트 활용 |
| **"계획 세워줘"** | Plan 에이전트 활용    |

### 한계점

- 서브 에이전트는 같은 세션 내에서 실행되어 **컨텍스트를 공유**함
- **독립적 관점의 검수**는 별도 세션 필요
- 체크리스트 기반 기계적 검증은 가능하나, 편향 제거는 불가

## 핸드오프 규칙

### 검수자에게 전달할 때

- **핸드오프 내용은 파일로 작성하지 않는다**
- **화면에 직접 출력**하여 검수자가 바로 확인할 수 있게 한다
- `docs/handoff/` 폴더에 별도 문서 생성 금지

### 출력 형식

```markdown
---
## 검수자 핸드오프: [작업명]

### 완료된 작업
- ...

### 변경된 파일
- ...

### 검수 항목
- [ ] ...

### 실행 방법
...
---
```

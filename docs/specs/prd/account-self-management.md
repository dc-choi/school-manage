# PRD: 계정 자기 관리

> SDD 작성자가 작성하는 제품 요구사항 문서입니다.
> 사업 에이전트의 `docs/business/` 문서를 기반으로 작성합니다.

## 배경/문제 요약

- **참고**: `docs/business/6_roadmap/roadmap.md` (2단계), `docs/business/STATUS.md`
- **문제**:
  - 현재 사용자가 비밀번호를 잊으면 스스로 복구할 수 없음 (운영자에게 연락해야 함)
  - 계정 이름(displayName) 변경 기능 없음
  - 계정 탈퇴 기능 없음 → 개인정보 처리방침에 명시된 "동의 철회, 삭제 요청 가능" 이행 불가
  - 사용자 자립 기능 부재로 CS 부담 증가, 운영 확장 시 병목
- **현재 상태**: 계정 정보 조회(`account.get`)와 개인정보 동의(`account.agreePrivacy`)만 존재
- **목표 상태**: 사용자가 직접 비밀번호 변경, 이름 변경, 계정 탈퇴를 수행할 수 있는 자기 관리 기능

## 목표/성공 기준

- **목표**:
  - 사용자가 운영자 도움 없이 계정 정보를 직접 관리할 수 있게 함
  - 개인정보보호법 준수: 사용자 요청에 의한 데이터 삭제(탈퇴) 지원
- **성공 지표**:
  - 계정 관련 CS 문의 0건 (운영자 개입 불필요)
  - 탈퇴 프로세스 완료 시 관련 데이터 완전 삭제 확인
- **측정 기간**: 배포 후 4주

## 사용자/대상

- **주요 사용자**: 서비스에 가입한 모임 운영자 (교리교사)
- **사용 맥락**:
  - 비밀번호를 잊었을 때 (비밀번호 변경)
  - 모임명이 바뀌었을 때 (이름 변경)
  - 서비스를 더 이상 사용하지 않을 때 (계정 탈퇴)

## 범위

### 포함

- 비밀번호 변경 (현재 비밀번호 확인 → 새 비밀번호 설정)
- 이름(displayName) 변경
- 계정 탈퇴 (관련 데이터 전체 삭제)
- 계정 설정 페이지 (`/settings`)

### 제외

- 비밀번호 재설정 (이메일 기반) — Account에 email 필드 없음, 별도 작업으로 분리
- 아이디(name) 변경 — 로그인 ID는 불변
- 이메일 인증, 2단계 인증(2FA)
- 계정 복구 (탈퇴 후 되돌리기)

## 사용자 시나리오

1. **비밀번호 변경**: 사용자가 설정 페이지에서 현재 비밀번호와 새 비밀번호를 입력하여 비밀번호를 변경한다.
2. **이름 변경**: 사용자가 설정 페이지에서 표시 이름을 수정하고 저장한다.
3. **계정 탈퇴**: 사용자가 설정 페이지에서 "계정 삭제"를 클릭하면, 경고와 함께 비밀번호 확인 후 계정과 모든 관련 데이터가 삭제된다.

## 요구사항

### 필수 (Must)

- [ ] 비밀번호 변경: 현재 비밀번호 검증 → 새 비밀번호 설정 (8자 이상)
- [ ] 이름 변경: displayName 수정 (2~20자)
- [ ] 계정 탈퇴: 비밀번호 확인 후 계정 + 그룹 + 학생 + 출석 데이터 완전 삭제
- [ ] 탈퇴 시 확인 다이얼로그: "모든 데이터가 영구 삭제됩니다" 경고
- [ ] 탈퇴 완료 후 세션 클리어 → 로그인 페이지 이동
- [ ] 계정 설정 페이지 (`/settings`) 신규

### 선택 (Should)

- [ ] 탈퇴 전 데이터 내보내기 (Export) 안내
- [ ] 비밀번호 변경 성공 시 GA4 이벤트 추적

### 제외 (Out)

- 비밀번호 재설정 (이메일 기반, email 필드 미존재)
- 아이디(name) 변경
- 계정 복구 (탈퇴 취소)
- 이메일 인증, 2FA

## 제약/가정/리스크

- **제약**:
  - Account 모델에 email 필드 없음 → 비밀번호 재설정(이메일 발송) 불가
  - 공유 계정 특성상 탈퇴 시 모든 데이터 삭제는 해당 모임 전체에 영향
- **가정**:
  - 비밀번호 변경은 현재 비밀번호를 아는 상태에서만 가능 (분실 시 운영자 문의 → 향후 이메일 기반 재설정 추가)
  - 계정 탈퇴는 소프트 삭제가 아닌 물리적 삭제 (개인정보보호법 "지체 없이 파기")
- **리스크**:
  - 탈퇴 시 실수로 데이터 삭제 → 비밀번호 확인 + 경고 다이얼로그로 방어
  - 공유 계정에서 한 사용자가 임의로 탈퇴 → 현재 구조상 방지 불가 (계정 소유자 책임)

## 의존성

- **내부**:
  - 기존 인증 플로우 (auth.login, account.get)
  - 개인정보 동의 완료 상태에서만 설정 접근 가능 (consentedProcedure)
- **외부**:
  - 없음

## 롤아웃/검증

- **출시 단계**: 단일 배포
- **이벤트/로그**:
  - `password_changed`: 비밀번호 변경 완료
  - `display_name_changed`: 이름 변경 완료
  - `account_deleted`: 계정 탈퇴 완료
- **검증 방법**: 배포 후 설정 페이지 접근률, 각 기능 사용률 모니터링

## 오픈 이슈

- [ ] 탈퇴 시 물리적 삭제 vs 소프트 삭제 → 개인정보보호법상 물리적 삭제 권장
- [ ] 비밀번호 재설정(이메일 기반)은 별도 작업으로 분리 여부

## 연결 문서

- 사업 문서: `docs/business/6_roadmap/roadmap.md` (2단계)
- 기능 설계: `docs/specs/functional-design/auth-account.md`
- PRD: `docs/specs/prd/privacy-consent.md` (개인정보 삭제 → 탈퇴 연계)

---

**작성일**: 2026-02-15
**작성자**: SDD 작성자
**상태**: Draft

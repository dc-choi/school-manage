# Task: 통계

> **"어떻게 만들지"**에 대해 업무를 나눈 문서입니다.
> Feature의 요구사항을 **구현 가능한 단위로 분할**하고, 각 업무의 순서와 의존성을 정의합니다.

## 상위 문서

- PRD: `docs/specs/prd/school-attendance.md` (로드맵 1단계)
- 기능 설계: `docs/specs/functional-design/statistics.md` (우수 출석 + 대시보드 통계 포함)
- Feature: `docs/specs/current/functional/features/statistics.md`

## 목표

대시보드에 출석 통계 카드를 추가하여, 사용자가 로그인 후 바로 주간/월간/연간 출석률과 평균 출석 인원, 우수 학생 현황을 확인할 수 있게 한다.

## 범위

### 포함

- [x] Student 테이블 gender 필드 추가 (마이그레이션)
- [x] 출석률 API (주간/월간/연간)
- [x] 평균 출석 인원 API (주간/월간/연간)
- [x] 성별 분포 API
- [x] 그룹별 출석률 TOP 5 API
- [x] 그룹별 우수 학생 TOP 5 API
- [x] 전체 우수 출석 학생 TOP 5 API
- [x] 그룹별 상세 통계 API (주간/월간/연간 출석률 + 평균 인원)
- [x] 대시보드 통계 차트 UI (Recharts)
- [x] 기존 통계 페이지 삭제 및 대시보드 통합

### 제외

- [ ] 통계 캐싱 (Nice to Have)
- [ ] 기간 직접 선택 (날짜 피커)

## 업무 분할

| # | 업무 | 설명 | 의존성 | 예상 규모 |
|---|------|------|--------|----------|
| 1 | DB 마이그레이션 | Student 테이블에 gender 필드 추가 | 없음 | S |
| 2 | tRPC 스키마 정의 | 통계 API Input/Output 스키마 | 없음 | S |
| 3 | 출석률 API | statistics.weekly/monthly/yearly | #2 | M |
| 4 | 평균 출석 인원 API | statistics.avgAttendance (주간/월간/연간) | #2 | M |
| 5 | 성별 분포 API | statistics.byGender | #1, #2 | M |
| 6 | 그룹 순위 API | statistics.topGroups | #2 | M |
| 7 | 그룹별 우수 학생 API | statistics.topByGroup | #2 | M |
| 8 | 전체 우수 학생 API | statistics.topOverall | #2 | M |
| 9 | 그룹별 상세 통계 API | statistics.groupStatistics (그룹별 주간/월간/연간) | #2 | M |
| 10 | Frontend hooks | useDashboardStatistics 훅 작성 | #3~#9 | M |
| 11 | 대시보드 UI | 차트 컴포넌트 (Recharts) 및 레이아웃 | #10 | L |

### 업무 순서 다이어그램

```
[#1 DB 마이그레이션] ────────────────────────────────────┐
                                                          │
[#2 스키마 정의] ─┬──▶ [#3 출석률 API] ─────────────────┐ │
                 │                                       │ │
                 ├──▶ [#4 평균 출석 인원 API] ──────────┤ │
                 │                                       │ │
                 ├──▶ [#5 성별 분포 API] ◀──────────────┼─┘
                 │                                       │
                 ├──▶ [#6 그룹 순위 API] ───────────────┤
                 │                                       │
                 ├──▶ [#7 그룹별 우수 학생 API] ────────┤
                 │                                       │
                 └──▶ [#8 전체 우수 학생 API] ──────────┼──▶ [#9 Frontend hooks] ──▶ [#10 대시보드 UI]
```

## 유스케이스

### UC-1: 대시보드에서 출석률 확인

**전제 조건**: 사용자가 로그인한 상태

**주요 흐름**:
1. 대시보드 페이지 진입
2. 주간/월간/연간 출석률 API 호출 (병렬)
3. 각 출석률 카드에 퍼센트 표시

**결과**: 주간/월간/연간 출석률이 카드 형태로 표시됨

**관련 업무**: #3, #9, #10

### UC-2: 대시보드에서 평균 출석 인원 확인

**전제 조건**: UC-1과 동일

**주요 흐름**:
1. 대시보드 페이지 진입
2. 평균 출석 인원 API 호출
3. 주간/월간/연간 평균 출석 인원 표시

**결과**: 평균 출석 인원이 "평균 N명" 형태로 표시됨

**관련 업무**: #4, #9, #10

### UC-3: 대시보드에서 성별 분포 확인

**전제 조건**: UC-1과 동일

**주요 흐름**:
1. 대시보드 페이지 진입
2. 성별 분포 API 호출
3. 남/여/미지정 비율 표시

**결과**: 성별 분포가 표시됨

**관련 업무**: #1, #5, #9, #10

### UC-4: 대시보드에서 그룹별/전체 우수 학생 확인

**전제 조건**: UC-1과 동일

**주요 흐름**:
1. 대시보드 페이지 진입
2. 그룹 순위, 그룹별 우수 학생, 전체 우수 학생 API 호출 (병렬)
3. 각 카드에 TOP 5 목록 표시

**결과**: 그룹별/전체 우수 학생이 표시됨

**관련 업무**: #6, #7, #8, #9, #10

## 엣지 케이스 & 예외 처리

| 상황 | 처리 방법 | 관련 업무 | 우선순위 |
|------|----------|----------|---------|
| 출석 데이터 없음 | 0% 또는 "데이터 없음" 표시 | #3, #4, #10 | High |
| 학생이 없는 그룹 | 해당 그룹 순위에서 제외 | #6 | High |
| 성별 미지정 학생 | "미지정" 카테고리로 집계 | #5 | High |
| year 파라미터 누락 | 현재 연도로 대체 | #3~#8 | Medium |
| 토큰 누락 | 401 UNAUTHORIZED 반환 | 전체 | High |
| API 호출 실패 | 에러 상태 표시 + 재시도 버튼 | #10 | High |

## 검증 체크리스트

### 기능 검증

- [ ] UC-1: 주간/월간/연간 출석률이 정상 표시되는가?
- [ ] UC-2: 주간/월간/연간 평균 출석 인원이 정상 표시되는가?
- [ ] UC-3: 성별 분포가 정상 표시되는가?
- [ ] UC-4: 그룹별/전체 우수 학생이 정상 표시되는가?
- [ ] 데이터 없을 때 적절한 안내 메시지가 표시되는가?
- [ ] 로딩 중 스피너가 표시되는가?

### 요구사항 추적

- [ ] PRD 로드맵 1단계 "통계 개선" 요구사항이 모두 반영되었는가?
- [ ] 기능 설계의 API 인터페이스가 구현되었는가?
- [ ] Feature의 인수 조건(AC-1 ~ AC-11)을 충족하는가?

## 다음 단계

- [x] Development 문서 작성: `docs/specs/current/functional/development/statistics.md`

---

**작성일**: 2026-01-22
**담당자**: SDD 작성자
**전체 예상 작업량**: L
**상태**: Approved

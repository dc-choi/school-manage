# Task: 출석 관리

> **"어떻게 만들지"**에 대해 업무를 나눈 문서입니다.
> Feature의 요구사항을 **구현 가능한 단위로 분할**하고, 각 업무의 순서와 의존성을 정의합니다.

## 상위 문서

- PRD: `docs/specs/prd/school-attendance.md` (로드맵 1단계)
- 기능 설계: `docs/specs/functional-design/attendance-management.md` (기본 + 달력 UI + 자동 저장 포함)
- Feature: `docs/specs/current/functional/features/attendance-management.md`

## 목표

그룹별 출석 데이터를 조회하고, 출석 입력/삭제를 일괄 처리한다.
달력 UI로 월별 출석 현황 조회 및 날짜별 출석 입력이 가능하도록 한다.

## 범위

### 포함

#### 기존 테이블 UI
- [x] 그룹 출석 현황 조회
- [x] 출석 일괄 입력(생성/수정)
- [x] 출석 일괄 삭제
- [x] 테이블 자동 저장 (로드맵 1단계)

#### 달력 UI (로드맵 1단계)
- [x] 달력 UI 컴포넌트 구현
- [x] 월별 달력 데이터 API (attendance.calendar)
- [x] 출석 입력 모달 컴포넌트
- [x] 자동 저장 기능 (즉시 저장)
- [x] 의무축일 계산 및 표시 API (liturgical.holydays)
- [x] 월 이동 기능

### 제외
- [ ] 개별 출석 수정 API
- [ ] 출석 통계(별도 Task에서 처리)
- [ ] 행사 관리 (3단계에서 처리)
- [ ] 년/월 직접 선택 피커 (Nice to Have)
- [ ] 월별 출석 통계 요약 (Nice to Have)

## 업무 분할

### 기존 테이블 UI

| # | 업무 | 설명 | 의존성 | 예상 규모 |
|---|------|------|--------|----------|
| A1 | 그룹 출석 현황 조회 | group.attendance API | 없음 | M |
| A2 | 출석 일괄 입력 | attendance.update (isFull=true) | 없음 | M |
| A3 | 출석 일괄 삭제 | attendance.update (isFull=false) | 없음 | M |
| A4 | 테이블 자동 저장 (로드맵 1단계) | 셀 변경 시 즉시 저장, 상태 인디케이터 | A2 | S |

### 달력 UI (로드맵 1단계)

| # | 업무 | 설명 | 의존성 | 예상 규모 |
|---|------|------|--------|----------|
| B1 | 의무축일 계산 로직 | 고정/이동 축일 계산, liturgical.holydays API | 없음 | M |
| B2 | 월별 달력 데이터 API | attendance.calendar API 구현 | 없음 | M |
| B3 | 날짜별 상세 조회 API | attendance.dayDetail API 구현 | 없음 | S |
| B4 | 달력 UI 컴포넌트 | 7x6 달력 레이아웃, 날짜 셀, 월 이동 | B1, B2 | L |
| B5 | 출석 입력 모달 | 학생 목록, 미사/교리 체크박스, 상태 표시 | B3 | M |
| B6 | 자동 저장 기능 | 체크 시 즉시 저장, 상태 인디케이터 | B5 | S |
| B7 | 달력-모달 연동 | 날짜 클릭 → 모달, 모달 닫기 → 달력 갱신 | B4, B5, B6 | M |

### 업무 순서 다이어그램

```
[B1 의무축일 계산] ──┐
                     ├──▶ [B4 달력 UI] ─────────────┬──▶ [B7 달력-모달 연동]
[B2 달력 데이터 API] ┘                              │
                                                    │
[B3 날짜별 상세 API] ──▶ [B5 출석 입력 모달] ──▶ [B6 자동 저장] ────────────┘
```

## 유스케이스

### UC-1: 그룹 출석 현황 조회

**전제 조건**: 유효한 Access Token이 있고 groupId가 숫자이다.

**주요 흐름**:
1. `group.attendance`에 요청한다.
2. 서버가 요일 배열과 학생/출석 데이터를 반환한다.

**결과**: 연도/요일 배열/학생/출석 데이터가 포함된 응답을 받는다.

### UC-2: 출석 일괄 입력

**전제 조건**: 유효한 Access Token이 있다.

**주요 흐름**:
1. 출석 데이터 배열과 `isFull=true`로 `attendance.update`에 요청한다.
2. 서버가 출석 데이터를 생성/수정한다.

**결과**: 처리된 행 수가 반환된다.

### UC-3: 출석 일괄 삭제

**전제 조건**: 유효한 Access Token이 있다.

**주요 흐름**:
1. 출석 데이터 배열과 `isFull=false`로 `attendance.update`에 요청한다.
2. 서버가 출석 데이터를 삭제한다.

**결과**: 삭제된 행 수가 반환된다.

### UC-3-1: 테이블에서 출석 자동 저장 (로드맵 1단계)

**전제 조건**: 유효한 Access Token이 있고 그룹을 선택한 상태

**주요 흐름**:
1. 테이블 UI에서 출석 셀(select) 값 변경
2. 시스템이 즉시 해당 출석 1건 저장 (attendance.update 호출)
3. 저장 상태 인디케이터 표시 (저장 중 → 저장 완료)
4. 2초 후 인디케이터 사라짐

**결과**: 출석 데이터 즉시 저장 완료

**관련 업무**: A4

### UC-4: 달력에서 월별 출석 현황 조회

**전제 조건**: 사용자가 로그인하고 그룹을 선택한 상태

**주요 흐름**:
1. 달력 페이지 진입
2. 현재 월의 달력 데이터 로드 (attendance.calendar)
3. 각 날짜 셀에 출석 현황 표시 (출석 N명 / 전체 M명)
4. 의무축일은 빨간색 배경으로 표시

**결과**: 월별 출석 현황이 달력 형태로 표시됨

**관련 업무**: B1, B2, B4

### UC-5: 날짜 클릭하여 출석 입력

**전제 조건**: UC-4 완료 상태

**주요 흐름**:
1. 달력에서 날짜 클릭
2. 출석 입력 모달 오픈 (attendance.dayDetail API 호출)
3. 학생별 미사/교리 체크박스 표시
4. 체크 시 즉시 저장 (저장 상태 표시)
5. 모달 닫기

**결과**: 출석 데이터 저장 완료

**관련 업무**: B3, B5, B6, B7

### UC-6: 모달 닫기 후 달력 갱신

**전제 조건**: UC-5 완료 상태

**주요 흐름**:
1. 모달 닫기 버튼 클릭 또는 외부 클릭
2. 모달 닫힘
3. 달력 출석 현황 갱신 (해당 날짜 셀)

**결과**: 달력에 최신 출석 현황 반영

**관련 업무**: B7

### UC-7: 월 이동

**전제 조건**: UC-4 완료 상태

**주요 흐름**:
1. 이전/다음 월 버튼 클릭
2. 해당 월 달력 데이터 로드
3. 달력 UI 갱신

**결과**: 선택한 월의 출석 현황 표시

**관련 업무**: B2, B4

## 엣지 케이스 & 예외 처리

| 상황 | 처리 방법 | 관련 업무 | 우선순위 |
|------|----------|----------|---------|
| groupId가 숫자가 아님 | BAD_REQUEST 응답 | A1 | High |
| 토큰 누락 | 인증 실패 응답 | 전체 | High |
| attendance 배열 누락/비어 있음 | BAD_REQUEST 응답 | A2, A3 | High |
| isFull 누락 | BAD_REQUEST 응답 | A2, A3 | High |
| year 누락/비정상 | 현재 연도로 처리 | A1 | Low |
| 출석 데이터 없는 날짜 | 0명 / 전체 M명 표시 | B2, B4 | High |
| 학생이 없는 그룹 | "학생이 없습니다" 안내 | B5 | High |
| 네트워크 오류 (데이터 로드) | 오류 메시지 + 재시도 버튼 | B2, B4 | High |
| 네트워크 오류 (저장 실패) | 오류 인디케이터 + 재시도 | B6 | High |
| 주일 아닌 날짜 클릭 | 출석 입력 허용 (행사 대응) | B7 | Medium |
| 의무축일 계산 오류 | 고정 축일만 표시 + 로그 | B1 | Medium |
| 출석 데이터 없는 월 | 빈 달력 표시 (현황 0) | B4 | Medium |

## 검증 체크리스트

### 기존 테이블 UI
- [x] 출석 조회 응답에 연도/요일/학생/출석 데이터가 포함되는가?
- [x] 출석 입력 요청 시 처리 행 수가 반환되는가?
- [x] 출석 삭제 요청 시 처리 행 수가 반환되는가?
- [x] 필수 파라미터 누락이 BAD_REQUEST로 처리되는가?
- [x] UC-3-1: 테이블 셀 변경 시 즉시 저장이 발생하는가?
- [x] UC-3-1: 저장 상태 인디케이터가 올바르게 표시되는가?

### 달력 UI
- [x] UC-4: 달력에서 월별 출석 현황이 정상 표시되는가?
- [x] UC-5: 날짜 클릭 시 모달이 열리고 출석 입력이 가능한가?
- [x] UC-6: 모달 닫기 시 달력이 갱신되는가?
- [x] UC-7: 월 이동이 정상 동작하는가?
- [x] 의무축일이 달력에 표시되는가?
- [x] 자동 저장이 정상 동작하는가?

### 엣지 케이스 검증
- [x] 출석 데이터 없는 날짜가 올바르게 표시되는가?
- [x] 네트워크 오류 시 적절한 피드백이 제공되는가?
- [x] 학생이 없는 그룹에서 적절한 안내가 표시되는가?

### 요구사항 추적
- [x] PRD 로드맵 1단계의 "달력 UI" 요구사항이 모두 반영되었는가?
- [x] 기능 설계의 흐름/상태가 구현되었는가?
- [x] Feature의 인수 조건(AC-1 ~ AC-8)을 충족하는가?

## 다음 단계

- [x] Development 문서 작성: `docs/specs/current/functional/development/attendance-management.md`

---

**작성일**: 2026-01-05
**최종 수정**: 2026-01-22
**담당자**: SDD 작성자
**전체 예상 작업량**: L
**상태**: Approved

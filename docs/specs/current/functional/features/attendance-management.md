# Feature: 출석 관리

> 이 문서는 기능의 **단일 정보원(Single Source of Truth)** 입니다.
> 기술적 구현 방법이 아닌 **"무엇을"** 만들지에 집중합니다.

## 상위 문서

- PRD: `docs/specs/prd/school-attendance.md` (로드맵 1단계)
- 기능 설계: `docs/specs/functional-design/attendance-management.md` (기본 + 달력 UI + 자동 저장 포함)

## 개요

그룹별 출석 현황을 조회하고, 학생별 출석 데이터를 일괄 입력/삭제한다.
달력 UI로 월별 출석 현황을 직관적으로 파악하고 날짜 클릭으로 출석을 입력할 수 있다.

## 배경

- **현재 문제점**
  - 매년 반복되는 출석 관리 업무를 디지털로 단순화해야 한다.
  - 출석 입력은 대량 처리(일괄 저장/삭제)가 필요하다.
  - 테이블 형태로 월별 전체 현황 파악이 어려움
  - 특정 날짜 출석 입력 시 스크롤 필요
  - 의무축일/행사와 일반 주일 구분 불가
- **목표 상태**
  - 달력 형태로 한눈에 월별 출석 현황 확인
  - 날짜 클릭 → 모달창에서 출석 입력
  - 의무축일(천주교 전례력 기반) 달력에 표시
  - 자동 저장 적용 (즉시 저장)

## 사용자 스토리

### US-1: 그룹 출석 현황을 확인한다

- **사용자**: 교사/관리자
- **원하는 것**: 특정 그룹의 출석 현황을 확인하기
- **이유**: 출석 체크와 관리에 활용하기 위해

### US-2: 출석 데이터를 저장한다

- **사용자**: 교사/관리자
- **원하는 것**: 학생별 출석 정보를 일괄 저장/삭제하기
- **이유**: 입력 속도를 높이기 위해

### US-2-1: 테이블에서 출석 자동 저장 (로드맵 1단계)

- **사용자**: 교사/관리자
- **원하는 것**: 테이블에서 출석 셀 값을 변경하면 자동으로 저장되기를 원함
- **이유**: 저장 버튼을 누르는 번거로움을 줄이고, 데이터 손실 위험을 방지하기 위해

### US-3: 달력에서 월별 출석 현황 확인

- **사용자**: 주일학교 교사
- **원하는 것**: 달력 형태로 월별 출석 현황을 한눈에 보고 싶다
- **이유**: 테이블 형태보다 전체 현황 파악이 빠르고 직관적이기 때문

### US-4: 날짜 클릭으로 출석 입력

- **사용자**: 주일학교 교사
- **원하는 것**: 달력에서 날짜를 클릭하여 해당 날짜의 출석을 입력하고 싶다
- **이유**: 스크롤 없이 원하는 날짜로 바로 이동할 수 있기 때문

### US-5: 의무축일 확인

- **사용자**: 주일학교 교사
- **원하는 것**: 달력에서 의무축일(부활, 성탄 등)을 확인하고 싶다
- **이유**: 특별 행사/축일과 일반 주일을 구분하여 출석 관리를 하기 위해

### US-6: 월 이동

- **사용자**: 주일학교 교사
- **원하는 것**: 이전/다음 월로 쉽게 이동하고 싶다
- **이유**: 과거 출석 기록 확인 및 수정이 필요하기 때문

## 기능 요구사항

### 필수 (Must Have)

#### 기존 테이블 UI
- [x] 그룹별 출석 데이터(학생/출석/요일)를 조회할 수 있어야 한다.
- [x] 연도별 출석 캘린더 정보를 제공해야 한다.
- [x] 출석 데이터는 일괄 입력(생성/수정)할 수 있어야 한다.
- [x] 출석 데이터는 일괄 삭제할 수 있어야 한다.
- [x] **FR-T1**: 출석 셀 변경 시 즉시 저장 (자동 저장) (로드맵 1단계)
  - 저장 상태 인디케이터 (저장 중/완료/오류)

#### 달력 UI (로드맵 1단계)
- [x] **FR-1**: 달력 UI로 월별 출석 현황 표시
  - 7열(일~토) x 5~6행 달력 레이아웃
  - 각 날짜 셀에 출석 현황 표시 (출석 N명 / 전체 M명)
- [x] **FR-2**: 날짜 클릭 시 출석 입력 모달 오픈
  - 선택한 날짜 표시
  - 학생 목록 + 미사/교리 체크박스
  - 출석 상태 표시 (◎ 출석, ○ 미사만, △ 교리만, - 결석)
- [x] **FR-3**: 출석 체크 시 즉시 저장 (자동 저장)
  - 저장 상태 인디케이터 (저장 중/완료/오류)
- [x] **FR-4**: 모달 닫기 시 달력 출석 현황 갱신
- [x] **FR-5**: 이전/다음 월 이동 버튼
  - 해당 월 달력 + 출석 현황 로드
- [x] **FR-6**: 의무축일 달력에 표시
  - 고정 축일: 천주의 성모 마리아(1/1), 성모 승천(8/15), 한국 성직자·수도자·신자들의 축일(9월 둘째 주일), 모든 성인(11/1), 성탄(12/25)
  - 이동 축일: 부활, 예수 승천, 성령 강림, 삼위일체, 성체 성혈, 예수 성심, 그리스도 왕
  - 빨간색 배경 또는 아이콘으로 구분

### 선택 (Nice to Have)

- [ ] **FR-7**: 특정 년/월 직접 선택 (드롭다운 또는 피커)
- [ ] **FR-8**: 출석 통계 요약 (월별 출석률 등)

## 엣지 케이스

| 케이스 | 예상 동작 |
|--------|----------|
| 잘못된 groupId | BAD_REQUEST 코드로 실패 응답 |
| 토큰 누락 | 인증 실패 응답 |
| attendance 배열 누락/비어 있음 | BAD_REQUEST 코드로 실패 응답 |
| isFull 누락 | BAD_REQUEST 코드로 실패 응답 |
| year 누락/비정상 | 현재 연도로 처리 |
| 출석 데이터 없는 날짜 | 0명 / 전체 M명 표시 |
| 주일 아닌 날짜 클릭 | 출석 입력 허용 (행사 등 대응) |
| 의무축일 계산 오류 | 고정 축일만 표시, 오류 로그 기록 |
| 네트워크 오류 (저장 실패) | 오류 인디케이터 + 재시도 버튼 |
| 출석 데이터 없는 월 | 빈 현황 표시 (0명/전체) |
| 학생이 없는 그룹 | "학생이 없습니다" 안내 메시지 |

## 인수 조건 (Acceptance Criteria)

### 기존 테이블 UI
- [x] 출석 조회 시 연도, 요일 배열, 학생, 출석 데이터가 반환된다.
- [x] 출석 입력 시 처리된 행 수와 isFull 플래그가 반환된다.
- [x] 출석 삭제 시 처리된 행 수와 isFull 플래그가 반환된다.
- [x] 필수 파라미터 누락 시 BAD_REQUEST로 실패한다.
- [x] **AC-T1**: 테이블 출석 셀 변경 시 API 호출이 즉시 발생한다 (로드맵 1단계)
- [x] **AC-T2**: 테이블에서 저장 중일 때 스피너와 "저장 중..." 텍스트가 표시된다
- [x] **AC-T3**: 테이블에서 저장 완료 시 체크 아이콘과 "저장 완료" 텍스트가 표시된다 (2초 후 사라짐)
- [x] **AC-T4**: 테이블에서 저장 실패 시 X 아이콘과 "저장 실패" 텍스트가 표시된다

### 달력 UI
- [x] **AC-1**: 달력에서 월별 출석 현황이 날짜별로 표시된다
- [x] **AC-2**: 날짜 클릭 시 해당 날짜의 출석 입력 모달이 열린다
- [x] **AC-3**: 모달에서 미사/교리 체크박스로 출석을 체크할 수 있다
- [x] **AC-4**: 출석 체크 시 즉시 저장되고 저장 상태가 표시된다
- [x] **AC-5**: 모달 닫기 시 달력의 출석 현황이 갱신된다
- [x] **AC-6**: 이전/다음 월 버튼으로 월 이동이 가능하다
- [x] **AC-7**: 의무축일이 달력에 시각적으로 구분되어 표시된다
- [x] **AC-8**: 기존 출석 데이터가 달력에 정상적으로 표시된다

## 관련 문서

- Task: `docs/specs/current/functional/tasks/attendance-management.md`
- Development: `docs/specs/current/functional/development/attendance-management.md`

---

**작성일**: 2026-01-05
**최종 수정**: 2026-01-22
**상태**: Approved
